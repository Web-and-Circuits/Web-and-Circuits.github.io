<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Neurons‚ÜíAgents">
    <title>Thinking Step by Step - How AI Learns to Reason</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #1b2d69 100%);
            color: #e1e1e1;
            line-height: 1.6;
            min-height: 100vh;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .act { display: none; animation: fadeIn 0.5s ease-in-out; }
        .act.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            text-align: center; font-size: 2.5em; margin-bottom: 0.3em;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .subtitle { text-align: center; color: #888; font-size: 1.1em; margin-bottom: 2em; }
        h2 { color: #4ecdc4; margin: 1.5em 0 0.8em; font-size: 1.8em; }
        h3 { color: #ff6b6b; margin: 1.2em 0 0.8em; }
        .nav-bar {
            display: flex; justify-content: center; gap: 10px; margin: 20px 0 30px;
            position: sticky; top: 0; z-index: 100; padding: 15px 0;
            background: rgba(26, 26, 26, 0.95); backdrop-filter: blur(10px);
        }
        .nav-btn {
            padding: 10px 24px; border: 2px solid #4ecdc4; background: transparent;
            color: #4ecdc4; border-radius: 25px; cursor: pointer; font-size: 1em;
            transition: all 0.3s;
        }
        .nav-btn:hover, .nav-btn.active { background: #4ecdc4; color: #1a1a1a; }
        .card {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; padding: 25px; margin: 20px 0;
        }
        .card.highlight { border-color: #4ecdc4; }
        .card.warn { border-color: #ff6b6b; }
        button {
            padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;
            font-size: 1em; transition: all 0.2s; margin: 5px;
        }
        .btn-primary { background: #4ecdc4; color: #1a1a1a; font-weight: 600; }
        .btn-primary:hover { background: #3dbdb5; transform: translateY(-1px); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #e1e1e1; border: 1px solid rgba(255,255,255,0.2); }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); }
        .btn-danger { background: #ff6b6b; color: #1a1a1a; font-weight: 600; }

        /* CoT Demo */
        .demo-split { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        @media (max-width: 700px) { .demo-split { grid-template-columns: 1fr; } }
        .demo-panel { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; }
        .demo-panel h4 { margin-bottom: 10px; font-size: 1.1em; }
        .demo-panel.direct h4 { color: #ff6b6b; }
        .demo-panel.cot h4 { color: #4ecdc4; }
        .typing { overflow: hidden; white-space: pre-wrap; }
        .typing .cursor { display: inline-block; width: 2px; height: 1em; background: #4ecdc4; animation: blink 0.7s infinite; vertical-align: text-bottom; }
        @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0; } }
        .answer-badge {
            display: inline-block; padding: 4px 12px; border-radius: 12px; margin-top: 10px; font-weight: 600;
        }
        .badge-wrong { background: rgba(255,107,107,0.2); color: #ff6b6b; }
        .badge-right { background: rgba(78,205,196,0.2); color: #4ecdc4; }

        /* ReAct Viz */
        .react-container { position: relative; margin: 30px 0; }
        .react-step {
            display: flex; align-items: flex-start; gap: 15px; margin: 12px 0;
            opacity: 0; transform: translateX(-20px); transition: all 0.4s ease;
            padding: 15px; border-radius: 12px;
        }
        .react-step.visible { opacity: 1; transform: translateX(0); }
        .react-step .icon {
            width: 44px; height: 44px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 1.3em;
            flex-shrink: 0;
        }
        .react-step.thought .icon { background: rgba(255,215,0,0.2); }
        .react-step.thought { background: rgba(255,215,0,0.05); border: 1px solid rgba(255,215,0,0.2); }
        .react-step.action .icon { background: rgba(78,205,196,0.2); }
        .react-step.action { background: rgba(78,205,196,0.05); border: 1px solid rgba(78,205,196,0.2); }
        .react-step.observation .icon { background: rgba(255,107,107,0.2); }
        .react-step.observation { background: rgba(255,107,107,0.05); border: 1px solid rgba(255,107,107,0.2); }
        .react-step.final .icon { background: rgba(78,205,196,0.3); }
        .react-step.final { background: rgba(78,205,196,0.08); border: 2px solid #4ecdc4; }
        .step-label { font-weight: 700; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px; }
        .thought .step-label { color: #ffd700; }
        .action .step-label { color: #4ecdc4; }
        .observation .step-label { color: #ff6b6b; }
        .final .step-label { color: #4ecdc4; }
        .step-content { color: #ccc; }
        .progress-dots { display: flex; gap: 8px; justify-content: center; margin: 15px 0; }
        .progress-dot {
            width: 12px; height: 12px; border-radius: 50%;
            background: rgba(255,255,255,0.15); transition: all 0.3s;
        }
        .progress-dot.active { background: #4ecdc4; box-shadow: 0 0 8px rgba(78,205,196,0.5); }
        .progress-dot.done { background: #4ecdc4; }

        /* Problem Selector */
        .problem-tabs { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        .problem-tab {
            padding: 8px 16px; border-radius: 20px; cursor: pointer;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15);
            color: #aaa; font-size: 0.9em; transition: all 0.2s;
        }
        .problem-tab:hover { border-color: #4ecdc4; color: #4ecdc4; }
        .problem-tab.active { background: rgba(78,205,196,0.15); border-color: #4ecdc4; color: #4ecdc4; }

        /* Toggle */
        .toggle-container { display: flex; align-items: center; gap: 12px; margin: 15px 0; }
        .toggle {
            width: 52px; height: 28px; border-radius: 14px; background: #ff6b6b;
            position: relative; cursor: pointer; transition: background 0.3s;
        }
        .toggle.on { background: #4ecdc4; }
        .toggle .knob {
            width: 22px; height: 22px; border-radius: 50%; background: white;
            position: absolute; top: 3px; left: 3px; transition: left 0.3s;
        }
        .toggle.on .knob { left: 27px; }

        /* Puzzle */
        .puzzle-container { margin: 20px 0; }
        .puzzle-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .puzzle-num { color: #4ecdc4; font-weight: 700; }
        .editor {
            width: 100%; min-height: 200px; background: #0d1117; color: #c9d1d9;
            border: 1px solid rgba(255,255,255,0.1); border-radius: 10px;
            padding: 15px; font-family: 'SF Mono', 'Fira Code', monospace; font-size: 0.9em;
            resize: vertical; tab-size: 4; line-height: 1.5;
        }
        .editor:focus { outline: none; border-color: #4ecdc4; }
        .output {
            background: #0d1117; border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px; padding: 15px; margin-top: 10px;
            font-family: 'SF Mono', 'Fira Code', monospace; font-size: 0.85em;
            color: #8b949e; min-height: 60px; white-space: pre-wrap;
        }
        .output.success { border-color: #4ecdc4; }
        .output.error { border-color: #ff6b6b; }
        .hint-btn { font-size: 0.85em; opacity: 0.6; }
        .hint-btn:hover { opacity: 1; }

        /* Quote */
        .paper-quote {
            border-left: 3px solid #ffd700; padding: 15px 20px; margin: 20px 0;
            background: rgba(255,215,0,0.05); border-radius: 0 10px 10px 0;
            font-style: italic; color: #ccc;
        }
        .paper-quote .source { display: block; margin-top: 8px; font-style: normal; color: #888; font-size: 0.9em; }

        /* GSM8K Chart */
        .chart-container { margin: 20px 0; }
        .bar-row { display: flex; align-items: center; gap: 10px; margin: 8px 0; }
        .bar-label { width: 120px; font-size: 0.85em; color: #aaa; text-align: right; flex-shrink: 0; }
        .bar-track { flex: 1; height: 28px; background: rgba(255,255,255,0.05); border-radius: 6px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; border-radius: 6px; transition: width 1.5s ease; display: flex; align-items: center; padding-left: 10px; font-size: 0.8em; font-weight: 600; }
        .bar-fill.direct { background: linear-gradient(90deg, #ff6b6b, #ff8e8e); color: #1a1a1a; }
        .bar-fill.cot { background: linear-gradient(90deg, #4ecdc4, #7eddd6); color: #1a1a1a; }

        /* Connection cards */
        .timeline { position: relative; padding-left: 30px; margin: 20px 0; }
        .timeline::before {
            content: ''; position: absolute; left: 12px; top: 0; bottom: 0;
            width: 2px; background: linear-gradient(to bottom, #ffd700, #4ecdc4, #ff6b6b);
        }
        .timeline-item { position: relative; margin: 20px 0; padding-left: 20px; }
        .timeline-item::before {
            content: ''; position: absolute; left: -24px; top: 6px;
            width: 12px; height: 12px; border-radius: 50%; background: #4ecdc4;
            border: 2px solid #1a1a1a;
        }
        .timeline-item:first-child::before { background: #ffd700; }
        .timeline-item:last-child::before { background: #ff6b6b; }
        .year-tag { color: #4ecdc4; font-weight: 700; font-size: 0.9em; }

        /* Pyodide loading */
        .pyodide-status {
            text-align: center; padding: 10px; font-size: 0.9em; color: #888;
            margin-bottom: 10px;
        }
        .pyodide-status.loading { color: #ffd700; }
        .pyodide-status.ready { color: #4ecdc4; }
    </style>
</head>
<body>
<div class="container">
    <h1>üß† Thinking Step by Step</h1>
    <p class="subtitle">How prompting unlocked reasoning ‚Äî and built the foundation of AI agents</p>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="showAct(1)">üîç Explore</button>
        <button class="nav-btn" onclick="showAct(2)">üî® Build</button>
        <button class="nav-btn" onclick="showAct(3)">üîó Connect</button>
    </div>

    <!-- ========== ACT 1: THE EXPLORABLE ========== -->
    <div id="act1" class="act active">
        <h2>The Problem with "Just Answer It"</h2>
        <p>What happens when you ask a language model a math question and expect an immediate answer? Let's find out.</p>

        <div class="problem-tabs" id="problemTabs"></div>

        <div id="problemDisplay" class="card" style="margin-top:15px;">
            <p id="problemText" style="font-size:1.15em; margin-bottom:10px;"></p>
        </div>

        <div class="toggle-container">
            <span style="color:#ff6b6b; font-weight:600;">Direct</span>
            <div class="toggle" id="cotToggle" onclick="toggleCoT()">
                <div class="knob"></div>
            </div>
            <span style="color:#4ecdc4; font-weight:600;">Chain of Thought</span>
        </div>

        <div class="demo-split">
            <div class="demo-panel direct" id="directPanel">
                <h4>‚ùå Direct Prompting</h4>
                <div id="directOutput" class="typing"></div>
            </div>
            <div class="demo-panel cot" id="cotPanel" style="opacity:0.3;">
                <h4>‚úÖ Chain of Thought</h4>
                <div id="cotOutput" class="typing"></div>
            </div>
        </div>

        <button class="btn-primary" onclick="runDemo()">‚ñ∂ Run</button>
        <button class="btn-secondary" onclick="nextProblem()">Next Problem ‚Üí</button>

        <!-- GSM8K Chart -->
        <h3>The GSM8K Results</h3>
        <p>On grade-school math (GSM8K), adding "Let's think step by step" was transformative:</p>
        <div class="chart-container" id="gsm8kChart">
            <div class="bar-row">
                <div class="bar-label">Direct (PaLM 540B)</div>
                <div class="bar-track"><div class="bar-fill direct" id="bar1" style="width:0%">17.9%</div></div>
            </div>
            <div class="bar-row">
                <div class="bar-label">CoT (PaLM 540B)</div>
                <div class="bar-track"><div class="bar-fill cot" id="bar2" style="width:0%">56.9%</div></div>
            </div>
            <div class="bar-row">
                <div class="bar-label">Direct (GPT-3 175B)</div>
                <div class="bar-track"><div class="bar-fill direct" id="bar3" style="width:0%">15.6%</div></div>
            </div>
            <div class="bar-row">
                <div class="bar-label">CoT (GPT-3 175B)</div>
                <div class="bar-track"><div class="bar-fill cot" id="bar4" style="width:0%">46.9%</div></div>
            </div>
        </div>
        <button class="btn-secondary" onclick="animateChart()" id="chartBtn">Show Results</button>

        <div class="paper-quote">
            "Chain of thought‚Äîa series of intermediate reasoning steps‚Äîsignificantly improves the ability of large language models to perform complex reasoning."
            <span class="source">‚Äî Wei et al., "Chain-of-Thought Prompting Elicits Reasoning in Large Language Models" (2022)</span>
        </div>

        <div class="card" style="margin-top:20px;">
            <h3 style="margin-top:0;">üîë Key Insight: Emergent Ability</h3>
            <p>CoT only works in large enough models (~100B+ parameters). Small models produce incoherent chains that hurt performance. The ability to reason step-by-step <em>emerges</em> at scale ‚Äî you can't train a small model to do it just by asking nicely.</p>
        </div>

        <!-- ReAct Section -->
        <h2>But What If You Need Facts?</h2>
        <p>Chain of Thought helps with reasoning, but what about questions that need <strong>external information</strong>? No amount of "thinking step by step" helps if the model doesn't know the answer.</p>

        <div class="card highlight" style="text-align:center;">
            <p style="font-size:1.15em; margin-bottom:5px;">üåç Try this question:</p>
            <p style="font-size:1.05em; color:#ffd700;" id="reactQuestion"></p>
        </div>

        <div class="problem-tabs" id="reactProblemTabs"></div>

        <p style="margin:15px 0;">This needs <strong>ReAct</strong>: <span style="color:#ffd700;">Think</span> ‚Üí <span style="color:#4ecdc4;">Act</span> ‚Üí <span style="color:#ff6b6b;">Observe</span> ‚Üí repeat.</p>

        <div class="react-container" id="reactSteps"></div>

        <div class="progress-dots" id="reactDots"></div>

        <div style="text-align:center; margin:15px 0;">
            <button class="btn-primary" id="reactNextBtn" onclick="advanceReact()">‚è≠ Next Step</button>
            <button class="btn-secondary" onclick="resetReact()">‚Ü∫ Reset</button>
        </div>

        <div class="paper-quote">
            "ReAct prompts LLMs to generate both verbal reasoning traces and actions pertaining to a task, which allows the model to dynamically reason to create, maintain, and adjust plans for acting while also interacting with external environments."
            <span class="source">‚Äî Yao et al., "ReAct: Synergizing Reasoning and Acting in Language Models" (2022)</span>
        </div>
    </div>

    <!-- ========== ACT 2: THE BUILD ========== -->
    <div id="act2" class="act">
        <h2>üî® Build: Reasoning & Tool Use</h2>
        <div id="pyodideStatus" class="pyodide-status loading">‚è≥ Loading Python environment...</div>

        <!-- Puzzle 1 -->
        <div class="puzzle-container">
            <div class="puzzle-header">
                <span class="puzzle-num">Puzzle 1/4</span>
                <span style="color:#ffd700;">Direct vs Chain-of-Thought</span>
                <button class="btn-secondary hint-btn" onclick="showHint(1)">üí° Hint</button>
            </div>
            <p>The <code>answer_directly</code> function just asks the question. Modify <code>answer_with_cot</code> to prepend "Let's think step by step" ‚Äî then see how the (simulated) model output changes.</p>
            <textarea class="editor" id="editor1">
# Simulated model: responds differently based on prompt format
def simulated_model(prompt):
    """A fake LLM that 'reasons' better with CoT."""
    if "step by step" in prompt.lower():
        if "tennis" in prompt:
            return ("Roger starts with 5 balls. He buys 2 cans, "
                    "each with 3 balls. 2 √ó 3 = 6. Total: 5 + 6 = 11.")
        elif "cafeteria" in prompt:
            return ("Started with 23 apples. Used 20, left with 3. "
                    "Bought 6 more. 3 + 6 = 9 apples.")
        return "Let me work through this... [detailed reasoning]"
    else:
        if "tennis" in prompt:
            return "The answer is 9."  # Wrong!
        elif "cafeteria" in prompt:
            return "The answer is 27."  # Wrong!
        return "The answer is 42."

def answer_directly(question):
    """Just ask the question."""
    prompt = f"Q: {question}\nA:"
    return simulated_model(prompt)

def answer_with_cot(question):
    """Add chain-of-thought prompting."""
    # TODO: Modify the prompt to include CoT trigger
    prompt = f"Q: {question}\nA:"
    return simulated_model(prompt)

# Test
q = "Roger has 5 tennis balls. He buys 2 cans of 3 tennis balls each. How many does he have now?"
print("=== Direct ===")
print(answer_directly(q))
print("\n=== Chain of Thought ===")
print(answer_with_cot(q))
</textarea>
            <button class="btn-primary" onclick="runPuzzle(1)">‚ñ∂ Run</button>
            <div class="output" id="output1"></div>
        </div>

        <!-- Puzzle 2 -->
        <div class="puzzle-container">
            <div class="puzzle-header">
                <span class="puzzle-num">Puzzle 2/4</span>
                <span style="color:#ffd700;">Parse a Chain of Thought</span>
                <button class="btn-secondary hint-btn" onclick="showHint(2)">üí° Hint</button>
            </div>
            <p>Given a raw chain-of-thought string, parse it into structured steps. Each sentence becomes a step with a number and text.</p>
            <textarea class="editor" id="editor2">
def parse_chain_of_thought(cot_text):
    """Parse a chain-of-thought into structured steps.
    
    Returns a list of dicts: [{"step": 1, "text": "..."}, ...]
    Split on sentence boundaries ('. ') and filter empties.
    """
    steps = []
    # TODO: Split the text into sentences and create step dicts
    
    return steps

# Test
cot = ("Roger starts with 5 tennis balls. "
       "He buys 2 cans of 3 balls each. "
       "2 times 3 equals 6 new balls. "
       "5 plus 6 equals 11 total balls.")

result = parse_chain_of_thought(cot)
for step in result:
    print(f"  Step {step['step']}: {step['text']}")

# Verify
assert len(result) == 4, f"Expected 4 steps, got {len(result)}"
assert result[0]["step"] == 1
assert "5 tennis" in result[0]["text"]
print("\n‚úÖ All checks passed!")
</textarea>
            <button class="btn-primary" onclick="runPuzzle(2)">‚ñ∂ Run</button>
            <div class="output" id="output2"></div>
        </div>

        <!-- Puzzle 3 -->
        <div class="puzzle-container">
            <div class="puzzle-header">
                <span class="puzzle-num">Puzzle 3/4</span>
                <span style="color:#ffd700;">Build a ReAct Loop</span>
                <button class="btn-secondary hint-btn" onclick="showHint(3)">üí° Hint</button>
            </div>
            <p>Implement the ReAct pattern: the agent thinks, chooses an action (search or calculate), observes the result, and repeats until it has a final answer.</p>
            <textarea class="editor" id="editor3">
def react_loop(question, tools, max_steps=5):
    """Run a ReAct loop: Thought ‚Üí Action ‚Üí Observation.
    
    The 'plan' list simulates what the model would generate.
    Each item is either:
      ("thought", "reasoning text")
      ("action", "tool_name", "tool_input")
      ("finish", "final answer")
    
    Execute actions using tools[tool_name](tool_input).
    Collect all trace entries as dicts.
    """
    # Pre-scripted plan for the demo
    plan = [
        ("thought", "I need to find which country won the 2022 World Cup."),
        ("action", "search", "2022 World Cup winner"),
        ("thought", "Argentina won. Now I need the capital of Argentina."),
        ("action", "search", "capital of Argentina"),
        ("thought", "The capital is Buenos Aires. Now I need its population."),
        ("action", "search", "population of Buenos Aires"),
        ("finish", "The population of Buenos Aires is approximately 3 million (city proper).")
    ]
    
    trace = []
    for item in plan:
        if item[0] == "thought":
            trace.append({"type": "thought", "content": item[1]})
        elif item[0] == "action":
            # TODO: Execute the tool and record both action and observation
            tool_name = item[1]
            tool_input = item[2]
            trace.append({"type": "action", "tool": tool_name, "input": tool_input})
            # Call the tool and record the observation
            pass
        elif item[0] == "finish":
            trace.append({"type": "finish", "content": item[1]})
            break
    return trace

# Tools
def search(query):
    data = {
        "2022 World Cup winner": "Argentina won the 2022 FIFA World Cup.",
        "capital of Argentina": "The capital of Argentina is Buenos Aires.",
        "population of Buenos Aires": "Buenos Aires has a population of ~3,120,612 (city proper)."
    }
    return data.get(query, "No results found.")

tools = {"search": search}

trace = react_loop("What's the population of the capital of the country that won the 2022 World Cup?", tools)
for entry in trace:
    icon = {"thought": "üí≠", "action": "üîß", "observation": "üëÅ", "finish": "‚úÖ"}.get(entry["type"], "?")
    if entry["type"] == "action":
        print(f"{icon} Action: {entry['tool']}({entry['input']})")
    elif entry["type"] == "observation":
        print(f"{icon} Observation: {entry['content']}")
    else:
        print(f"{icon} {entry['type'].title()}: {entry['content']}")

# Verify
types = [e["type"] for e in trace]
assert "observation" in types, "Missing observations! Did you call the tool?"
assert types[-1] == "finish", "Should end with finish"
print("\n‚úÖ ReAct loop working!")
</textarea>
            <button class="btn-primary" onclick="runPuzzle(3)">‚ñ∂ Run</button>
            <div class="output" id="output3"></div>
        </div>

        <!-- Puzzle 4 -->
        <div class="puzzle-container">
            <div class="puzzle-header">
                <span class="puzzle-num">Puzzle 4/4</span>
                <span style="color:#ffd700;">Tool-Using Agent</span>
                <button class="btn-secondary hint-btn" onclick="showHint(4)">üí° Hint</button>
            </div>
            <p>Build an agent with a calculator and a lookup table. It decides which tool to use based on the query, like Toolformer (Paper #28).</p>
            <textarea class="editor" id="editor4">
class ToolAgent:
    def __init__(self):
        self.tools = {
            "calculate": self.calculate,
            "lookup": self.lookup,
        }
        self.knowledge = {
            "earth_radius_km": 6371,
            "speed_of_light_mps": 299792458,
            "pi": 3.14159265,
            "population_tokyo": 13960000,
            "population_paris": 2161000,
        }
    
    def calculate(self, expression):
        """Safe calculator: only allows numbers and basic ops."""
        allowed = set("0123456789.+-*/() ")
        if not all(c in allowed for c in expression):
            return "Error: invalid characters"
        try:
            return str(eval(expression))  # safe: only numbers/ops
        except:
            return "Error: could not evaluate"
    
    def lookup(self, key):
        """Look up a fact from the knowledge base."""
        return self.knowledge.get(key, f"Unknown key: {key}")
    
    def choose_tool(self, query):
        """Decide which tool to use based on the query.
        
        TODO: Return ("calculate", expression) if the query contains
        math-like tokens (+, -, *, /, digits), otherwise 
        return ("lookup", key) extracting the key from the query.
        
        Hint: for lookup, try matching known keys.
        """
        # TODO: Implement tool selection logic
        pass
    
    def run(self, query):
        """Full agent loop: think, select tool, execute, return."""
        print(f"üí≠ Thinking about: {query}")
        choice = self.choose_tool(query)
        if choice is None:
            return "I don't know how to handle that."
        tool_name, tool_input = choice
        print(f"üîß Using tool: {tool_name}({tool_input})")
        result = self.tools[tool_name](tool_input)
        print(f"üëÅ Result: {result}")
        return result

agent = ToolAgent()

# Test queries
queries = [
    "What is 6371 * 2 * 3.14159265?",     # Earth's circumference
    "What is population_tokyo?",             # Lookup
    "Calculate (299792458 / 1000)",          # km/s
    "Look up pi",                            # Lookup
]

results = []
for q in queries:
    print(f"\n{'='*40}")
    r = agent.run(q)
    results.append(r)

# Verify
assert float(results[0]) > 40000, "Earth circumference should be ~40,000 km"
assert results[1] == 13960000 or str(results[1]) == "13960000"
print("\n‚úÖ Tool-using agent works!")
</textarea>
            <button class="btn-primary" onclick="runPuzzle(4)">‚ñ∂ Run</button>
            <div class="output" id="output4"></div>
        </div>
    </div>

    <!-- ========== ACT 3: THE CONNECTION ========== -->
    <div id="act3" class="act">
        <h2>üîó The Connection</h2>

        <div class="card highlight">
            <h3 style="margin-top:0;">The Reasoning Revolution</h3>
            <p>Two papers in 2022 changed everything about what we thought language models could do ‚Äî not by changing the <em>models</em>, but by changing how we <em>talk</em> to them.</p>
        </div>

        <div class="timeline">
            <div class="timeline-item">
                <span class="year-tag">January 2022 ‚Äî Chain of Thought</span>
                <p>Wei et al. showed that adding "Let's think step by step" to a prompt could triple a model's math accuracy. The model already <em>knew</em> how to reason ‚Äî it just needed permission to show its work. Like a student who can solve problems on scratch paper but freezes when told to give an instant answer.</p>
            </div>
            <div class="timeline-item">
                <span class="year-tag">October 2022 ‚Äî ReAct</span>
                <p>Yao et al. took the next step: what if the model could not only think, but <em>act</em>? By interleaving reasoning with tool use ‚Äî search engines, calculators, APIs ‚Äî the model could tackle questions it couldn't answer from memory alone. The Thought‚ÜíAction‚ÜíObservation loop was born.</p>
            </div>
            <div class="timeline-item">
                <span class="year-tag">February 2023 ‚Äî Toolformer</span>
                <p>Schick et al. (Paper #28) asked: what if the model <em>learned</em> to use tools on its own, without being prompted? Toolformer trained models to insert API calls into their own text ‚Äî a calculator here, a search there ‚Äî whenever it would help. No human had to design the reasoning format.</p>
            </div>
            <div class="timeline-item">
                <span class="year-tag">January 2025 ‚Äî DeepSeek-R1</span>
                <p>DeepSeek took a different path: instead of <em>prompting</em> a model to think step by step, they <em>trained</em> it to reason internally using reinforcement learning. The model develops its own chain of thought during training, not at inference time. The reasoning is baked in, not bolted on.</p>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0;">CoT-only vs Act-only vs ReAct</h3>
            <p>Yao et al. compared three approaches head-to-head:</p>
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px; margin-top:15px;">
                <div style="background:rgba(255,215,0,0.08); border:1px solid rgba(255,215,0,0.3); border-radius:10px; padding:15px;">
                    <strong style="color:#ffd700;">CoT-only</strong>
                    <p style="font-size:0.9em; margin-top:5px;">Reasons well but hallucinates facts. Can't verify anything. Gets confident about wrong answers.</p>
                </div>
                <div style="background:rgba(78,205,196,0.08); border:1px solid rgba(78,205,196,0.3); border-radius:10px; padding:15px;">
                    <strong style="color:#4ecdc4;">Act-only</strong>
                    <p style="font-size:0.9em; margin-top:5px;">Uses tools but without a plan. Searches randomly. Doesn't synthesize what it finds.</p>
                </div>
                <div style="background:rgba(255,107,107,0.08); border:1px solid rgba(255,107,107,0.3); border-radius:10px; padding:15px;">
                    <strong style="color:#ff6b6b;">ReAct ‚ú®</strong>
                    <p style="font-size:0.9em; margin-top:5px;">Best of both: reasons about <em>what</em> to search, uses results to update its plan. Recovers from errors.</p>
                </div>
            </div>
        </div>

        <div class="paper-quote">
            "The combination of reasoning and acting allows the model to dynamically reason to create, maintain, and adjust plans for acting, while also interacting with external environments to incorporate additional information into reasoning."
            <span class="source">‚Äî Yao et al. (2022)</span>
        </div>

        <div class="card warn">
            <h3 style="margin-top:0;">ü§ñ Meta Moment</h3>
            <p>The AI agent that built this curriculum module? It uses ReAct. Right now. It <em>thinks</em> about what to build, <em>acts</em> by writing code and reading files, <em>observes</em> the results, and adjusts. You're learning about the very architecture that's teaching you.</p>
            <p style="margin-top:10px;">Every AI agent ‚Äî from ChatGPT plugins to coding assistants to autonomous researchers ‚Äî is built on the foundation these two papers laid: <strong>let the model think, and give it tools.</strong></p>
        </div>

        <div class="card">
            <h3 style="margin-top:0;">üìö The Papers</h3>
            <ul style="list-style:none; padding:0;">
                <li style="margin:12px 0;">üìÑ <strong style="color:#4ecdc4;">Paper #13:</strong> "Chain-of-Thought Prompting Elicits Reasoning in Large Language Models" ‚Äî Wei et al., 2022</li>
                <li style="margin:12px 0;">üìÑ <strong style="color:#4ecdc4;">Paper #14:</strong> "ReAct: Synergizing Reasoning and Acting in Language Models" ‚Äî Yao et al., 2022</li>
                <li style="margin:12px 0;">üìÑ <strong style="color:#4ecdc4;">Paper #28:</strong> "Toolformer: Language Models Can Teach Themselves to Use Tools" ‚Äî Schick et al., 2023</li>
            </ul>
        </div>

        <div style="text-align:center; margin:40px 0; padding:30px; border-top:1px solid rgba(255,255,255,0.1);">
            <p style="color:#888;">Module 7 of 30 ¬∑ AI Beach Week üèñÔ∏è</p>
            <p style="color:#4ecdc4; margin-top:10px; font-size:1.1em;">Next up: Mixture of Experts ‚Üí</p>
        </div>
    </div>
</div>

<script>
// ==================== NAV ====================
function showAct(n) {
    document.querySelectorAll('.act').forEach(a => a.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('act' + n).classList.add('active');
    document.querySelectorAll('.nav-btn')[n-1].classList.add('active');
    window.scrollTo({top: 0, behavior: 'smooth'});
    if (n === 2 && !window.pyodideReady) loadPyodide();
}

// ==================== PROBLEMS ====================
const problems = [
    {
        text: "Roger has 5 tennis balls. He buys 2 cans of 3 tennis balls each. How many tennis balls does he have now?",
        direct: "The answer is 9.",
        directWrong: true,
        cot: "Roger starts with 5 balls.\nHe buys 2 cans √ó 3 balls = 6 new balls.\n5 + 6 = 11 balls total.",
        cotAnswer: "11",
        correctAnswer: "11"
    },
    {
        text: "The cafeteria had 23 apples. If they used 20 to make lunch and bought 6 more, how many apples do they have?",
        direct: "The answer is 27.",
        directWrong: true,
        cot: "Started with 23 apples.\nUsed 20 for lunch: 23 - 20 = 3 remaining.\nBought 6 more: 3 + 6 = 9 apples.",
        cotAnswer: "9",
        correctAnswer: "9"
    },
    {
        text: "Shawn has five toys. For Christmas, he got two toys each from his mom and dad. How many toys does he have now?",
        direct: "The answer is 7.",
        directWrong: true,
        cot: "Shawn starts with 5 toys.\nMom gave 2 toys. Dad gave 2 toys.\n5 + 2 + 2 = 9 toys total.",
        cotAnswer: "9",
        correctAnswer: "9"
    },
    {
        text: "If there are 3 cars in the parking lot and 2 more cars arrive, then 1 leaves, how many cars are there?",
        direct: "The answer is 6.",
        directWrong: true,
        cot: "Start with 3 cars.\n2 arrive: 3 + 2 = 5 cars.\n1 leaves: 5 - 1 = 4 cars.",
        cotAnswer: "4",
        correctAnswer: "4"
    }
];

let currentProblem = 0;
let cotEnabled = false;

function initProblems() {
    const tabs = document.getElementById('problemTabs');
    problems.forEach((p, i) => {
        const tab = document.createElement('div');
        tab.className = 'problem-tab' + (i === 0 ? ' active' : '');
        tab.textContent = 'Problem ' + (i + 1);
        tab.onclick = () => selectProblem(i);
        tabs.appendChild(tab);
    });
    showProblem(0);
}

function selectProblem(i) {
    currentProblem = i;
    document.querySelectorAll('#problemTabs .problem-tab').forEach((t, j) =>
        t.classList.toggle('active', j === i));
    showProblem(i);
}

function showProblem(i) {
    document.getElementById('problemText').textContent = problems[i].text;
    document.getElementById('directOutput').innerHTML = '';
    document.getElementById('cotOutput').innerHTML = '';
}

function nextProblem() {
    selectProblem((currentProblem + 1) % problems.length);
}

function toggleCoT() {
    cotEnabled = !cotEnabled;
    const toggle = document.getElementById('cotToggle');
    toggle.classList.toggle('on', cotEnabled);
    document.getElementById('cotPanel').style.opacity = cotEnabled ? '1' : '0.3';
}

function typeText(el, text, speed, cb) {
    el.innerHTML = '';
    let i = 0;
    function tick() {
        if (i <= text.length) {
            el.innerHTML = text.slice(0, i).replace(/\n/g, '<br>') + '<span class="cursor"></span>';
            i++;
            setTimeout(tick, speed);
        } else {
            el.innerHTML = text.replace(/\n/g, '<br>');
            if (cb) cb();
        }
    }
    tick();
}

function runDemo() {
    const p = problems[currentProblem];
    typeText(document.getElementById('directOutput'), p.direct, 30, () => {
        document.getElementById('directOutput').innerHTML +=
            '<br><span class="answer-badge badge-wrong">‚úó Wrong</span>';
    });
    if (cotEnabled) {
        typeText(document.getElementById('cotOutput'), p.cot, 20, () => {
            document.getElementById('cotOutput').innerHTML +=
                '<br><span class="answer-badge badge-right">‚úì Correct: ' + p.cotAnswer + '</span>';
        });
    } else {
        document.getElementById('cotOutput').innerHTML =
            '<span style="color:#555;">Enable Chain of Thought to see ‚Üë</span>';
    }
}

// ==================== GSM8K CHART ====================
function animateChart() {
    document.getElementById('bar1').style.width = '17.9%';
    document.getElementById('bar2').style.width = '56.9%';
    document.getElementById('bar3').style.width = '15.6%';
    document.getElementById('bar4').style.width = '46.9%';
    document.getElementById('chartBtn').textContent = '3x improvement from just adding "Let\'s think step by step"!';
    document.getElementById('chartBtn').style.color = '#4ecdc4';
}

// ==================== REACT DEMO ====================
const reactProblems = [
    {
        question: "What's the population of the capital of the country that won the 2022 World Cup?",
        steps: [
            {type:'thought', icon:'üí≠', label:'Thought', text:'I need to find which country won the 2022 World Cup. Let me search for that.'},
            {type:'action', icon:'üîç', label:'Action', text:'search("2022 FIFA World Cup winner")'},
            {type:'observation', icon:'üëÅ', label:'Observation', text:'Argentina won the 2022 FIFA World Cup, defeating France in the final.'},
            {type:'thought', icon:'üí≠', label:'Thought', text:'Argentina won. Now I need to find the capital of Argentina.'},
            {type:'action', icon:'üîç', label:'Action', text:'search("capital of Argentina")'},
            {type:'observation', icon:'üëÅ', label:'Observation', text:'The capital of Argentina is Buenos Aires.'},
            {type:'thought', icon:'üí≠', label:'Thought', text:'The capital is Buenos Aires. Now I need its population.'},
            {type:'action', icon:'üîç', label:'Action', text:'search("Buenos Aires population")'},
            {type:'observation', icon:'üëÅ', label:'Observation', text:'Buenos Aires has a population of approximately 3,120,612 (city proper).'},
            {type:'final', icon:'‚úÖ', label:'Answer', text:'The population of Buenos Aires, capital of Argentina (2022 World Cup winner), is approximately 3.1 million.'}
        ]
    },
    {
        question: "How many times heavier is the largest planet in our solar system than the planet closest to the sun?",
        steps: [
            {type:'thought', icon:'üí≠', label:'Thought', text:'I need to identify the largest planet and the planet closest to the sun, then compare their masses.'},
            {type:'action', icon:'üîç', label:'Action', text:'search("largest planet in solar system")'},
            {type:'observation', icon:'üëÅ', label:'Observation', text:'Jupiter is the largest planet in our solar system with a mass of 1.898 √ó 10¬≤‚Å∑ kg.'},
            {type:'thought', icon:'üí≠', label:'Thought', text:'Jupiter is the largest. The closest planet to the sun is Mercury. Let me find its mass.'},
            {type:'action', icon:'üîç', label:'Action', text:'search("mass of Mercury planet")'},
            {type:'observation', icon:'üëÅ', label:'Observation', text:'Mercury has a mass of 3.285 √ó 10¬≤¬≥ kg.'},
            {type:'thought', icon:'üí≠', label:'Thought', text:'Now I need to divide Jupiter\'s mass by Mercury\'s mass.'},
            {type:'action', icon:'üßÆ', label:'Action', text:'calculate(1.898e27 / 3.285e23)'},
            {type:'observation', icon:'üëÅ', label:'Observation', text:'Result: 5,778'},
            {type:'final', icon:'‚úÖ', label:'Answer', text:'Jupiter is approximately 5,778 times heavier than Mercury.'}
        ]
    }
];

let currentReactProblem = 0;
let reactStep = 0;

function initReact() {
    const tabs = document.getElementById('reactProblemTabs');
    reactProblems.forEach((p, i) => {
        const tab = document.createElement('div');
        tab.className = 'problem-tab' + (i === 0 ? ' active' : '');
        tab.textContent = 'Question ' + (i + 1);
        tab.onclick = () => selectReactProblem(i);
        tabs.appendChild(tab);
    });
    loadReactProblem(0);
}

function selectReactProblem(i) {
    currentReactProblem = i;
    document.querySelectorAll('#reactProblemTabs .problem-tab').forEach((t, j) =>
        t.classList.toggle('active', j === i));
    loadReactProblem(i);
}

function loadReactProblem(i) {
    const rp = reactProblems[i];
    document.getElementById('reactQuestion').textContent = rp.question;
    reactStep = 0;
    const container = document.getElementById('reactSteps');
    container.innerHTML = '';
    rp.steps.forEach((s) => {
        const div = document.createElement('div');
        div.className = 'react-step ' + s.type;
        div.innerHTML = `<div class="icon">${s.icon}</div><div><div class="step-label">${s.label}</div><div class="step-content">${s.text}</div></div>`;
        container.appendChild(div);
    });
    // dots
    const dots = document.getElementById('reactDots');
    dots.innerHTML = '';
    rp.steps.forEach(() => {
        const d = document.createElement('div');
        d.className = 'progress-dot';
        dots.appendChild(d);
    });
    document.getElementById('reactNextBtn').textContent = '‚è≠ Next Step';
}

function advanceReact() {
    const rp = reactProblems[currentReactProblem];
    if (reactStep >= rp.steps.length) return;
    const steps = document.querySelectorAll('#reactSteps .react-step');
    const dots = document.querySelectorAll('#reactDots .progress-dot');
    steps[reactStep].classList.add('visible');
    dots[reactStep].classList.add('active');
    if (reactStep > 0) dots[reactStep - 1].classList.replace('active', 'done');
    reactStep++;
    if (reactStep >= rp.steps.length) {
        document.getElementById('reactNextBtn').textContent = '‚úì Complete!';
    }
}

function resetReact() {
    loadReactProblem(currentReactProblem);
}

// ==================== PYODIDE ====================
let pyodide = null;
window.pyodideReady = false;

async function loadPyodide() {
    const status = document.getElementById('pyodideStatus');
    try {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js';
        document.head.appendChild(script);
        script.onload = async () => {
            pyodide = await window.loadPyodide();
            window.pyodideReady = true;
            status.className = 'pyodide-status ready';
            status.textContent = '‚úÖ Python ready!';
            setTimeout(() => status.style.display = 'none', 2000);
        };
        script.onerror = () => {
            status.textContent = '‚ö†Ô∏è Could not load Pyodide. Puzzles will run in simulation mode.';
            status.style.color = '#ff6b6b';
        };
    } catch(e) {
        status.textContent = '‚ö†Ô∏è Pyodide failed: ' + e.message;
    }
}

async function runPuzzle(n) {
    const code = document.getElementById('editor' + n).value;
    const output = document.getElementById('output' + n);
    output.className = 'output';
    output.textContent = 'Running...';
    try {
        if (pyodide) {
            pyodide.runPython(`
import sys, io
sys.stdout = io.StringIO()
sys.stderr = io.StringIO()
`);
            try {
                pyodide.runPython(code);
                const stdout = pyodide.runPython('sys.stdout.getvalue()');
                const stderr = pyodide.runPython('sys.stderr.getvalue()');
                output.textContent = stdout + (stderr ? '\n‚ö† ' + stderr : '');
                output.className = stderr && !stdout ? 'output error' : 'output success';
            } catch(e) {
                output.textContent = '‚ùå ' + e.message;
                output.className = 'output error';
            }
        } else {
            // Simulation fallback
            output.textContent = '‚è≥ Pyodide not loaded yet. Switch to Build tab first to initialize.';
            output.className = 'output error';
        }
    } catch(e) {
        output.textContent = '‚ùå ' + e.message;
        output.className = 'output error';
    }
}

// ==================== HINTS ====================
const hints = {
    1: 'Add "Let\'s think step by step.\\n" to the prompt string, before "A:"',
    2: 'Use cot_text.split(". ") to get sentences, then enumerate them. Don\'t forget to handle trailing periods.',
    3: 'After appending the action, call tools[tool_name](tool_input) and append an observation entry: {"type": "observation", "content": result}',
    4: 'Check if any math operator (+, -, *, /) is in the query for calculate. For lookup, check which knowledge key appears in the query.'
};

function showHint(n) {
    alert('üí° Hint: ' + hints[n]);
}

// ==================== INIT ====================
initProblems();
initReact();
</script>
</body>
</html>
