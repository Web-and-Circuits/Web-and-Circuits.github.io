<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Mind for Numbers ‚Äî Brain Gym</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--card:#14141f;--accent:#6c5ce7;--accent2:#00cec9;--accent3:#fd79a8;--text:#e0e0e8;--dim:#666;--radius:16px;--glow:0 0 30px rgba(108,92,231,0.15)}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden}
.hero{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:2rem;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;width:600px;height:600px;border-radius:50%;background:radial-gradient(circle,rgba(108,92,231,0.12),transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation:pulse 6s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:translate(-50%,-50%) scale(1)}50%{transform:translate(-50%,-50%) scale(1.3)}}
.hero h1{font-size:clamp(2.2rem,6vw,4rem);font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:.5rem;position:relative}
.hero .subtitle{font-size:clamp(1rem,2.5vw,1.3rem);color:var(--dim);max-width:600px;margin-bottom:2rem}
.hero .author{font-size:.9rem;color:var(--accent);letter-spacing:2px;text-transform:uppercase;margin-bottom:.5rem}
.scroll-hint{position:absolute;bottom:2rem;animation:bob 2s ease-in-out infinite;font-size:1.5rem;opacity:.5}
@keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(10px)}}

section{max-width:800px;margin:0 auto;padding:3rem 1.5rem}
.section-tag{font-size:.75rem;text-transform:uppercase;letter-spacing:3px;color:var(--accent);margin-bottom:.5rem}
.section-title{font-size:clamp(1.5rem,4vw,2.2rem);font-weight:700;margin-bottom:.5rem}
.quote-block{border-left:3px solid var(--accent);padding:.8rem 1.2rem;margin:1.5rem 0;background:rgba(108,92,231,0.06);border-radius:0 var(--radius) var(--radius) 0;font-style:italic;color:#b0b0c0}
.quote-block cite{display:block;margin-top:.4rem;font-style:normal;font-size:.8rem;color:var(--dim)}
p.desc{color:#aab;margin:1rem 0 1.5rem;font-size:.95rem}

.card{background:var(--card);border-radius:var(--radius);padding:1.5rem;margin:1.5rem 0;box-shadow:var(--glow);border:1px solid rgba(255,255,255,0.04)}

/* Buttons */
.btn{display:inline-flex;align-items:center;justify-content:center;min-height:48px;min-width:48px;padding:.7rem 1.5rem;border:none;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .25s;touch-action:manipulation}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:#5a4bd4;transform:translateY(-1px)}
.btn-secondary{background:rgba(108,92,231,0.15);color:var(--accent);border:1px solid rgba(108,92,231,0.3)}
.btn-secondary:hover{background:rgba(108,92,231,0.25)}
.btn-accent2{background:var(--accent2);color:#000}
.btn-accent3{background:var(--accent3);color:#000}
.btn-group{display:flex;gap:.8rem;flex-wrap:wrap;margin:1rem 0}

/* Toggle */
.toggle-container{display:flex;align-items:center;gap:1rem;margin:1rem 0}
.toggle{width:64px;height:34px;background:#333;border-radius:17px;position:relative;cursor:pointer;transition:background .3s}
.toggle.active{background:var(--accent2)}
.toggle::after{content:'';position:absolute;width:28px;height:28px;background:#fff;border-radius:50%;top:3px;left:3px;transition:transform .3s}
.toggle.active::after{transform:translateX(30px)}

/* Visualizations */
.pinball-viz{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;margin:1.5rem 0}
.pinball-box{width:280px;height:320px;background:#0d0d18;border-radius:var(--radius);position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.06)}
.pinball-box .label{position:absolute;bottom:.8rem;left:50%;transform:translateX(-50%);font-size:.8rem;font-weight:600;z-index:2}
.bumper{position:absolute;border-radius:50%;transition:all .5s}

/* Chunk viz */
.chunk-container{display:flex;flex-wrap:wrap;gap:.6rem;margin:1rem 0;justify-content:center}
.chunk-piece{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;cursor:pointer;transition:all .4s;border:2px solid transparent}
.chunk-piece.ungrouped{background:rgba(108,92,231,0.15);color:var(--accent);border-color:rgba(108,92,231,0.3)}
.chunk-piece.grouped{border-color:var(--accent2);background:rgba(0,206,201,0.15);color:var(--accent2);transform:scale(1.05)}
.chunk-piece.merged{background:var(--accent2);color:#000;font-size:.7rem;width:auto;padding:0 1rem;border-color:var(--accent2)}

/* Working memory test */
.wm-display{font-size:clamp(2rem,8vw,3.5rem);font-weight:800;text-align:center;min-height:80px;display:flex;align-items:center;justify-content:center;font-family:'Courier New',monospace;letter-spacing:.3rem;color:var(--accent2)}
.wm-input{background:#1a1a2e;border:2px solid rgba(108,92,231,0.3);border-radius:12px;padding:.8rem 1rem;font-size:1.2rem;color:var(--text);width:100%;text-align:center;font-family:'Courier New',monospace;letter-spacing:.2rem;outline:none;transition:border-color .3s}
.wm-input:focus{border-color:var(--accent)}
.wm-score{font-size:1.1rem;text-align:center;margin-top:1rem;font-weight:600}
.wm-result-good{color:var(--accent2)}
.wm-result-bad{color:var(--accent3)}

/* Pomodoro */
.pomo-timer{font-size:clamp(3rem,12vw,5rem);font-weight:800;text-align:center;font-family:'Courier New',monospace;color:var(--accent);margin:1rem 0}
.pomo-timer.break-mode{color:var(--accent2)}
.pomo-progress{width:100%;height:8px;background:#1a1a2e;border-radius:4px;overflow:hidden;margin:1rem 0}
.pomo-bar{height:100%;background:var(--accent);border-radius:4px;transition:width .3s}
.pomo-bar.break-mode{background:var(--accent2)}
.pomo-status{text-align:center;font-size:.9rem;color:var(--dim)}

/* Einstellung */
.ein-puzzle{display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem;max-width:300px;margin:1rem auto}
.ein-cell{aspect-ratio:1;background:#1a1a2e;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;font-weight:700;cursor:pointer;transition:all .3s;border:2px solid transparent;min-height:48px}
.ein-cell.selected{border-color:var(--accent);background:rgba(108,92,231,0.2)}
.ein-cell.solved{border-color:var(--accent2);background:rgba(0,206,201,0.2);color:var(--accent2)}
.ein-cell.wrong{border-color:var(--accent3);animation:shake .4s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}

/* Memory Palace */
.palace-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:1rem;margin:1rem 0}
.palace-room{background:#1a1a2e;border-radius:var(--radius);padding:1.2rem;text-align:center;cursor:pointer;transition:all .3s;border:2px solid transparent;min-height:100px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.4rem}
.palace-room:hover{border-color:rgba(108,92,231,0.3);transform:translateY(-2px)}
.palace-room.revealed{border-color:var(--accent2);background:rgba(0,206,201,0.08)}
.palace-room .room-icon{font-size:2rem}
.palace-room .room-name{font-size:.75rem;color:var(--dim)}
.palace-room .room-item{font-size:.85rem;font-weight:600;color:var(--accent2);opacity:0;transition:opacity .4s;min-height:1.2em}
.palace-room.revealed .room-item{opacity:1}

/* Illusions */
.illusion-card{background:#1a1a2e;border-radius:var(--radius);padding:1.5rem;margin:1rem 0;text-align:center}
.illusion-options{display:flex;flex-direction:column;gap:.6rem;margin-top:1rem}
.illusion-opt{padding:.8rem 1rem;background:rgba(108,92,231,0.08);border:1px solid rgba(108,92,231,0.15);border-radius:12px;cursor:pointer;transition:all .3s;text-align:left;min-height:48px;display:flex;align-items:center}
.illusion-opt:hover{border-color:rgba(108,92,231,0.4)}
.illusion-opt.correct{border-color:var(--accent2);background:rgba(0,206,201,0.12);color:var(--accent2)}
.illusion-opt.wrong{border-color:var(--accent3);background:rgba(253,121,168,0.1);color:var(--accent3)}

/* Dividers */
.divider{width:60px;height:3px;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:2px;margin:4rem auto}

/* Footer */
footer{text-align:center;padding:3rem 1.5rem;color:var(--dim);font-size:.8rem}

/* Responsive */
@media(max-width:600px){
  .pinball-box{width:100%;max-width:280px}
  section{padding:2rem 1rem}
}
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <div class="author">Barbara Oakley</div>
  <h1>A Mind for Numbers</h1>
  <p class="subtitle">An interactive brain gym exploring how you learn math, science, and everything else.</p>
  <p class="scroll-hint">‚Üì</p>
</div>

<!-- 1. FOCUSED vs DIFFUSE -->
<section id="focused-diffuse">
  <div class="section-tag">Section 01</div>
  <h2 class="section-title">Focused vs. Diffuse Mode</h2>
  <div class="quote-block">
    "The harder you push your brain to come up with something creative, the less creative your ideas will be. Relaxation is an important part of hard work."
    <cite>‚Äî Shaun Wassell, computer engineering student</cite>
  </div>
  <p class="desc">Your brain has two thinking modes. <strong>Focused mode</strong> is tight, concentrated, analytical‚Äîlike a flashlight with a narrow beam. <strong>Diffuse mode</strong> is relaxed, big-picture thinking that makes unexpected connections. Toggle between them to see how thoughts travel differently.</p>
  
  <div class="toggle-container">
    <span>Focused</span>
    <div class="toggle" id="modeToggle" onclick="toggleMode()"></div>
    <span>Diffuse</span>
  </div>
  
  <div class="pinball-viz">
    <div class="pinball-box" id="pinballCanvas">
      <div class="label" id="pinballLabel">Focused Mode</div>
    </div>
  </div>
  <p class="desc" id="modeExplanation" style="text-align:center">In focused mode, bumpers are packed tight. Your thought bounces in a small area‚Äîgreat for familiar problems, but you might miss solutions elsewhere.</p>
</section>

<div class="divider"></div>

<!-- 2. CHUNKING -->
<section id="chunking">
  <div class="section-tag">Section 02</div>
  <h2 class="section-title">Chunking</h2>
  <div class="quote-block">
    "Mathematics is amazingly compressible: you may struggle a long time, step by step, to work through the same process. But once you really understand it, there is often a tremendous mental compression."
    <cite>‚Äî William Thurston, Fields Medal winner</cite>
  </div>
  <p class="desc">Chunking compresses many small ideas into one smoothly recalled unit. Click the pieces below to group them into chunks. Watch how separate fragments merge into powerful, compact knowledge.</p>
  
  <div class="card">
    <div style="text-align:center;margin-bottom:.5rem;font-size:.85rem;color:var(--dim)" id="chunkInstruction">Click related pieces to group them into chunks</div>
    <div class="chunk-container" id="chunkContainer"></div>
    <div class="btn-group" style="justify-content:center;margin-top:1rem">
      <button class="btn btn-secondary" onclick="resetChunks()">Reset</button>
      <button class="btn btn-primary" onclick="autoChunk()">Auto-Chunk ‚ú®</button>
    </div>
    <p id="chunkResult" style="text-align:center;margin-top:.8rem;font-size:.9rem;color:var(--accent2);min-height:1.5em"></p>
  </div>
</section>

<div class="divider"></div>

<!-- 3. WORKING MEMORY -->
<section id="working-memory">
  <div class="section-tag">Section 03</div>
  <h2 class="section-title">Working Memory Limits</h2>
  <div class="quote-block">
    "Your working memory holds only about four chunks of information. We tend to automatically group memory items into chunks, so it seems bigger than it actually is."
    <cite>‚Äî Barbara Oakley</cite>
  </div>
  <p class="desc">Your working memory is like a juggler with only <strong>4 slots</strong>. Test yours: watch the sequence, then type it back. How far can you go before the juggler drops a ball?</p>
  
  <div class="card">
    <div class="wm-display" id="wmDisplay">Ready?</div>
    <div style="margin:1rem 0">
      <input class="wm-input" id="wmInput" placeholder="Type the sequence..." maxlength="20" disabled autocomplete="off">
    </div>
    <div class="btn-group" style="justify-content:center">
      <button class="btn btn-primary" id="wmStartBtn" onclick="wmStart()">Start Test</button>
    </div>
    <div class="wm-score" id="wmScore"></div>
  </div>
</section>

<div class="divider"></div>

<!-- 4. EINSTELLUNG -->
<section id="einstellung">
  <div class="section-tag">Section 04</div>
  <h2 class="section-title">The Einstellung Effect</h2>
  <div class="quote-block">
    "An idea you already have in mind, or your simple initial thought, prevents a better idea or solution from being found."
    <cite>‚Äî Barbara Oakley</cite>
  </div>
  <p class="desc">Einstellung (German for "mindset") is when your existing approach <strong>blocks</strong> you from seeing a better solution. Try this number puzzle: find pairs that sum to <strong id="einTarget">10</strong>. The obvious pairs are easy‚Äîbut can you find the <em>hidden</em> pair that requires stepping back?</p>
  
  <div class="card">
    <div class="ein-puzzle" id="einPuzzle"></div>
    <p style="text-align:center;font-size:.85rem;color:var(--dim);margin-top:.5rem" id="einHint">Select two numbers that add up to <span id="einTargetHint">10</span>. Find all pairs!</p>
    <p id="einResult" style="text-align:center;margin-top:.8rem;font-weight:600;min-height:1.5em"></p>
    <div class="btn-group" style="justify-content:center">
      <button class="btn btn-secondary" onclick="einReset()">New Puzzle</button>
      <button class="btn btn-accent2" onclick="einReveal()" id="einRevealBtn" style="display:none">Step Back (Diffuse Mode) üßò</button>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- 5. POMODORO -->
<section id="pomodoro">
  <div class="section-tag">Section 05</div>
  <h2 class="section-title">The Pomodoro Technique</h2>
  <div class="quote-block">
    "The dread of doing a task uses up more time and energy than doing the task itself."
    <cite>‚Äî Rita Emmett, procrastination expert</cite>
  </div>
  <p class="desc">Procrastination triggers real pain in anticipation‚Äîbut the pain vanishes once you start. The Pomodoro technique: <strong>25 minutes focused work ‚Üí reward</strong>. Focus on <em>process</em>, not product. Try a mini Pomodoro below.</p>
  
  <div class="card">
    <div class="pomo-timer" id="pomoTimer">25:00</div>
    <div class="pomo-progress"><div class="pomo-bar" id="pomoBar" style="width:0%"></div></div>
    <div class="pomo-status" id="pomoStatus">Focus on process, not product.</div>
    <div class="btn-group" style="justify-content:center">
      <button class="btn btn-primary" id="pomoBtn" onclick="pomoToggle()">Start Focus üçÖ</button>
      <button class="btn btn-secondary" onclick="pomoReset()">Reset</button>
    </div>
    <p style="text-align:center;font-size:.8rem;color:var(--dim);margin-top:.8rem">(Demo uses 1-minute cycles for quick testing)</p>
  </div>
</section>

<div class="divider"></div>

<!-- 6. ILLUSIONS OF COMPETENCE -->
<section id="illusions">
  <div class="section-tag">Section 06</div>
  <h2 class="section-title">Illusions of Competence</h2>
  <div class="quote-block">
    "Merely glancing at a problem's solution and thinking you know how to do it is one of the most common illusions of competence in learning."
    <cite>‚Äî Barbara Oakley</cite>
  </div>
  <p class="desc">Rereading feels productive but barely works. You <em>think</em> you know the material because it looks familiar‚Äîbut can you actually recall it? Test yourself: read the fact, then see if you can pick the right answer without looking back.</p>
  
  <div class="card" id="illusionArea"></div>
</section>

<div class="divider"></div>

<!-- 7. MEMORY PALACE -->
<section id="memory-palace">
  <div class="section-tag">Section 07</div>
  <h2 class="section-title">The Memory Palace</h2>
  <div class="quote-block">
    "We have outstanding visual and spatial memory systems. Memory tricks used by ancient and modern experts tap into these naturally supersized abilities."
    <cite>‚Äî Barbara Oakley</cite>
  </div>
  <p class="desc">Your brain remembers <em>places</em> brilliantly. The memory palace technique: deposit vivid images along a familiar route. Click each room below to reveal the learning concept hidden inside.</p>
  
  <div class="card">
    <div class="palace-grid" id="palaceGrid"></div>
    <p style="text-align:center;margin-top:1rem;font-size:.85rem;color:var(--dim)" id="palaceHint">Click rooms to reveal the learning concepts. Can you recall them all?</p>
    <div class="btn-group" style="justify-content:center;margin-top:1rem">
      <button class="btn btn-secondary" onclick="palaceReset()">Hide All</button>
      <button class="btn btn-primary" onclick="palaceTest()">Test Recall</button>
    </div>
    <p id="palaceResult" style="text-align:center;margin-top:.8rem;font-size:.9rem;min-height:1.5em"></p>
  </div>
</section>

<div class="divider"></div>

<!-- 8. DELIBERATE PRACTICE -->
<section id="deliberate-practice">
  <div class="section-tag">Section 08</div>
  <h2 class="section-title">Deliberate Practice</h2>
  <div class="quote-block">
    "Deficiencies of innate ability may be compensated for through persistent hard work and concentration. One might say that work substitutes for talent, or better yet that it creates talent."
    <cite>‚Äî Santiago Ram√≥n y Cajal, Nobel Laureate</cite>
  </div>
  <p class="desc">Experts don't just practice‚Äîthey focus on their <strong>weakest points</strong>. A violinist drills the fumbled passage, not the easy one. Interleaving (mixing problem types) beats overlearning (repeating the same type). Build your chunked library, and Lady Luck will be on your side.</p>
  
  <div class="card" style="text-align:center">
    <div style="font-size:3rem;margin-bottom:1rem">üß±‚ÜíüèõÔ∏è</div>
    <h3 style="color:var(--accent);margin-bottom:.8rem">The Brick Wall Metaphor</h3>
    <p style="color:#aab;font-size:.9rem;max-width:500px;margin:0 auto">Learning is like building a brick wall. Each focused session lays bricks. Each rest period lets the mortar dry. <strong>Cram</strong> and you get a pile of rubble. <strong>Space it out</strong> and you build a cathedral.</p>
    <div style="display:flex;justify-content:center;gap:2rem;margin-top:1.5rem;flex-wrap:wrap">
      <div>
        <div style="font-size:2rem" id="brickAnim">üß±</div>
        <div style="font-size:.75rem;color:var(--dim);margin-top:.3rem">Spaced Practice</div>
        <div style="color:var(--accent2);font-size:.85rem;font-weight:600">Strong wall</div>
      </div>
      <div>
        <div style="font-size:2rem">üí•</div>
        <div style="font-size:.75rem;color:var(--dim);margin-top:.3rem">Cramming</div>
        <div style="color:var(--accent3);font-size:.85rem;font-weight:600">Rubble pile</div>
      </div>
    </div>
  </div>

  <div class="quote-block" style="margin-top:2rem">
    "The first principle is that you must not fool yourself‚Äîand you are the easiest person to fool."
    <cite>‚Äî Richard Feynman</cite>
  </div>

  <div class="card" style="text-align:center;margin-top:1.5rem">
    <h3 style="color:var(--accent);margin-bottom:1rem">The 10 Rules of Good Studying</h3>
    <div style="text-align:left;max-width:500px;margin:0 auto;font-size:.9rem;color:#aab">
      <p>1. <strong>Use recall</strong> ‚Äî don't just reread<br>
      2. <strong>Test yourself</strong> ‚Äî constantly<br>
      3. <strong>Chunk</strong> ‚Äî compress ideas into units<br>
      4. <strong>Space repetition</strong> ‚Äî a little every day<br>
      5. <strong>Interleave</strong> ‚Äî mix problem types<br>
      6. <strong>Take breaks</strong> ‚Äî let diffuse mode work<br>
      7. <strong>Use analogies</strong> ‚Äî explain like you're 5<br>
      8. <strong>Focus</strong> ‚Äî Pomodoro, no distractions<br>
      9. <strong>Eat your frogs first</strong> ‚Äî hardest thing first<br>
      10. <strong>Mental contrast</strong> ‚Äî visualize your goal</p>
    </div>
  </div>
</section>

<footer>
  <p>Based on <em>A Mind for Numbers</em> by Barbara Oakley, Ph.D.</p>
  <p style="margin-top:.3rem">"Lady Luck favors the one who tries."</p>
</footer>

<script>
// ===== 1. FOCUSED vs DIFFUSE PINBALL =====
let isDiffuse = false;
const bumpers = [];
let ball = null;
let animFrame;
const canvas = document.getElementById('pinballCanvas');

function createBumpers() {
  bumpers.forEach(b => b.el && b.el.remove());
  bumpers.length = 0;
  const count = isDiffuse ? 8 : 24;
  const w = canvas.clientWidth, h = canvas.clientHeight;
  for (let i = 0; i < count; i++) {
    const size = isDiffuse ? 16 : 12;
    const el = document.createElement('div');
    el.className = 'bumper';
    el.style.width = el.style.height = size + 'px';
    el.style.background = isDiffuse ? 'rgba(0,206,201,0.4)' : 'rgba(108,92,231,0.5)';
    const x = 20 + Math.random() * (w - 40);
    const y = 20 + Math.random() * (h - 60);
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    canvas.appendChild(el);
    bumpers.push({ x: x + size/2, y: y + size/2, r: size/2, el });
  }
}

function createBall() {
  if (ball && ball.el) ball.el.remove();
  const el = document.createElement('div');
  el.style.cssText = 'position:absolute;width:10px;height:10px;border-radius:50%;background:#fff;z-index:1;transition:none;box-shadow:0 0 8px rgba(255,255,255,0.5)';
  canvas.appendChild(el);
  const w = canvas.clientWidth;
  ball = { x: w/2, y: 20, vx: (Math.random()-0.5)*4, vy: 2, el };
}

function animateBall() {
  if (!ball) return;
  const w = canvas.clientWidth, h = canvas.clientHeight;
  ball.x += ball.vx; ball.y += ball.vy;
  ball.vy += 0.05;
  // walls
  if (ball.x < 5) { ball.x = 5; ball.vx *= -0.8; }
  if (ball.x > w-15) { ball.x = w-15; ball.vx *= -0.8; }
  if (ball.y < 5) { ball.y = 5; ball.vy *= -0.8; }
  if (ball.y > h-15) { ball.y = 20; ball.vx = (Math.random()-0.5)*4; ball.vy = 2; }
  // bumpers
  bumpers.forEach(b => {
    const dx = ball.x+5 - b.x, dy = ball.y+5 - b.y;
    const dist = Math.sqrt(dx*dx+dy*dy);
    if (dist < b.r + 5) {
      const angle = Math.atan2(dy, dx);
      const speed = Math.sqrt(ball.vx*ball.vx+ball.vy*ball.vy);
      ball.vx = Math.cos(angle) * speed * 0.9;
      ball.vy = Math.sin(angle) * speed * 0.9;
      ball.x = b.x + Math.cos(angle) * (b.r + 6);
      ball.y = b.y + Math.sin(angle) * (b.r + 6);
      b.el.style.background = isDiffuse ? 'rgba(0,206,201,0.8)' : 'rgba(108,92,231,0.9)';
      setTimeout(() => b.el.style.background = isDiffuse ? 'rgba(0,206,201,0.4)' : 'rgba(108,92,231,0.5)', 200);
    }
  });
  ball.el.style.left = ball.x + 'px';
  ball.el.style.top = ball.y + 'px';
  animFrame = requestAnimationFrame(animateBall);
}

function toggleMode() {
  isDiffuse = !isDiffuse;
  document.getElementById('modeToggle').classList.toggle('active', isDiffuse);
  document.getElementById('pinballLabel').textContent = isDiffuse ? 'Diffuse Mode' : 'Focused Mode';
  document.getElementById('modeExplanation').textContent = isDiffuse
    ? 'In diffuse mode, bumpers are spread apart. Your thought travels farther, making unexpected connections‚Äîbut can\'t think as precisely.'
    : 'In focused mode, bumpers are packed tight. Your thought bounces in a small area‚Äîgreat for familiar problems, but you might miss solutions elsewhere.';
  cancelAnimationFrame(animFrame);
  createBumpers();
  createBall();
  animateBall();
}

// ===== 2. CHUNKING =====
const chunkData = [
  { items: ['f','=','m','a'], label: 'f = ma' },
  { items: ['E','=','m','c¬≤'], label: 'E = mc¬≤' },
  { items: ['Œî','x','Œî','p'], label: 'ŒîxŒîp ‚â• ƒß/2' },
];
let currentChunkGroup = 0;
let selectedPieces = [];

function initChunks() {
  const container = document.getElementById('chunkContainer');
  container.innerHTML = '';
  selectedPieces = [];
  currentChunkGroup = 0;
  document.getElementById('chunkResult').textContent = '';
  const allPieces = [];
  chunkData.forEach((g, gi) => {
    g.items.forEach((item, ii) => {
      allPieces.push({ text: item, group: gi, idx: ii });
    });
  });
  // shuffle
  for (let i = allPieces.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [allPieces[i], allPieces[j]] = [allPieces[j], allPieces[i]];
  }
  allPieces.forEach((p, i) => {
    const el = document.createElement('div');
    el.className = 'chunk-piece ungrouped';
    el.textContent = p.text;
    el.dataset.group = p.group;
    el.dataset.idx = p.idx;
    el.onclick = () => clickChunkPiece(el, p);
    container.appendChild(el);
  });
}

function clickChunkPiece(el, p) {
  if (el.classList.contains('merged')) return;
  el.classList.toggle('grouped');
  if (el.classList.contains('grouped')) {
    selectedPieces.push({ el, p });
  } else {
    selectedPieces = selectedPieces.filter(s => s.el !== el);
  }
  // check if all selected are same group and complete
  if (selectedPieces.length >= 3) {
    const groups = selectedPieces.map(s => s.p.group);
    const targetGroup = groups[0];
    if (groups.every(g => g === targetGroup)) {
      const needed = chunkData[targetGroup].items.length;
      const have = selectedPieces.filter(s => s.p.group === targetGroup).length;
      if (have >= needed) {
        // merge
        const sameGroup = selectedPieces.filter(s => s.p.group === targetGroup);
        sameGroup.forEach((s, i) => {
          if (i === 0) {
            s.el.textContent = chunkData[targetGroup].label;
            s.el.className = 'chunk-piece merged';
          } else {
            s.el.style.display = 'none';
          }
        });
        selectedPieces = selectedPieces.filter(s => s.p.group !== targetGroup);
        currentChunkGroup++;
        if (currentChunkGroup >= chunkData.length) {
          document.getElementById('chunkResult').textContent = 'üéâ All chunks formed! Each now takes only 1 slot in working memory.';
        } else {
          document.getElementById('chunkResult').textContent = `‚úÖ Chunk formed! ${chunkData.length - currentChunkGroup} remaining.`;
        }
      }
    }
  }
}

function resetChunks() { initChunks(); }

function autoChunk() {
  const container = document.getElementById('chunkContainer');
  container.innerHTML = '';
  chunkData.forEach(g => {
    const el = document.createElement('div');
    el.className = 'chunk-piece merged';
    el.textContent = g.label;
    container.appendChild(el);
  });
  document.getElementById('chunkResult').textContent = 'üéâ All chunks formed! Complex ideas compressed into single, recallable units.';
}

// ===== 3. WORKING MEMORY TEST =====
let wmLevel = 3;
let wmSequence = '';
let wmPlaying = false;

function wmStart() {
  if (wmPlaying) return;
  wmPlaying = true;
  wmLevel = 3;
  document.getElementById('wmScore').textContent = '';
  wmRound();
}

function wmRound() {
  const display = document.getElementById('wmDisplay');
  const input = document.getElementById('wmInput');
  const btn = document.getElementById('wmStartBtn');
  input.disabled = true;
  input.value = '';
  btn.disabled = true;
  
  wmSequence = '';
  for (let i = 0; i < wmLevel; i++) {
    wmSequence += Math.floor(Math.random() * 10);
  }
  
  // show digits one by one
  let i = 0;
  display.textContent = '';
  const interval = setInterval(() => {
    display.textContent = wmSequence[i];
    i++;
    if (i >= wmSequence.length) {
      clearInterval(interval);
      setTimeout(() => {
        display.textContent = '?';
        input.disabled = false;
        input.focus();
      }, 800);
    }
  }, 700);
}

document.getElementById('wmInput').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') {
    const val = this.value.trim();
    const display = document.getElementById('wmDisplay');
    const score = document.getElementById('wmScore');
    
    if (val === wmSequence) {
      wmLevel++;
      if (wmLevel > 12) {
        display.textContent = 'üèÜ';
        score.className = 'wm-score wm-result-good';
        score.textContent = `Incredible! You held ${wmLevel-1} items. Far beyond the typical 4-slot limit!`;
        wmPlaying = false;
        document.getElementById('wmStartBtn').disabled = false;
        return;
      }
      display.textContent = '‚úì';
      score.className = 'wm-score wm-result-good';
      score.textContent = `Level ${wmLevel-1} passed! Now trying ${wmLevel} digits...`;
      setTimeout(wmRound, 1000);
    } else {
      display.textContent = wmSequence;
      score.className = 'wm-score wm-result-bad';
      const msg = wmLevel <= 4
        ? `Your working memory held ${wmLevel-1} items ‚Äî right around the typical limit of 4!`
        : wmLevel <= 6
        ? `${wmLevel-1} items! Above average. You're chunking naturally.`
        : `${wmLevel-1} items! Impressive working memory span.`;
      score.textContent = msg;
      wmPlaying = false;
      document.getElementById('wmStartBtn').disabled = false;
    }
    this.disabled = true;
  }
});

// ===== 4. EINSTELLUNG =====
let einNumbers = [];
let einSelected = [];
let einFound = [];
let einTarget = 10;
let einTrickyFound = false;

function einInit() {
  einTarget = [10, 12, 15][Math.floor(Math.random()*3)];
  document.getElementById('einTarget').textContent = einTarget;
  document.getElementById('einTargetHint').textContent = einTarget;
  
  // Create numbers with obvious pairs and one tricky pair
  const pairs = [];
  // 2 obvious pairs
  for (let i = 0; i < 2; i++) {
    const a = 1 + Math.floor(Math.random() * (einTarget - 2));
    pairs.push([a, einTarget - a]);
  }
  // 1 tricky pair (involves a negative or uses existing number + another)
  // Actually let's use a hidden pair: numbers that look unrelated but sum correctly
  // Place decoy numbers that DON'T sum to target
  einNumbers = [];
  pairs.forEach(p => { einNumbers.push(p[0]); einNumbers.push(p[1]); });
  
  // Add some decoys
  const decoys = [];
  while (decoys.length < 6) {
    const d = 1 + Math.floor(Math.random() * (einTarget + 5));
    if (!einNumbers.includes(d) && !decoys.includes(d)) decoys.push(d);
  }
  // Make sure one decoy pair sums to target (the hidden one)
  const hiddenA = decoys[0];
  decoys[1] = einTarget - hiddenA;
  if (decoys[1] <= 0 || decoys[1] === hiddenA) { decoys[1] = einTarget - decoys[2]; if (decoys[1] <= 0) decoys[1] = 1; decoys[2] = einTarget - decoys[1]; }
  
  einNumbers = einNumbers.concat(decoys);
  // Shuffle
  for (let i = einNumbers.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [einNumbers[i], einNumbers[j]] = [einNumbers[j], einNumbers[i]];
  }
  // Only keep first 16 (4x4 grid)
  einNumbers = einNumbers.slice(0, 16);
  
  einSelected = [];
  einFound = [];
  einTrickyFound = false;
  renderEin();
  document.getElementById('einResult').textContent = '';
  document.getElementById('einRevealBtn').style.display = 'none';
  
  // Show reveal button after 3 found pairs or 10 seconds
  setTimeout(() => {
    if (!einTrickyFound) document.getElementById('einRevealBtn').style.display = '';
  }, 8000);
}

function renderEin() {
  const grid = document.getElementById('einPuzzle');
  grid.innerHTML = '';
  einNumbers.forEach((n, i) => {
    const cell = document.createElement('div');
    cell.className = 'ein-cell';
    if (einFound.includes(i)) cell.classList.add('solved');
    if (einSelected.includes(i)) cell.classList.add('selected');
    cell.textContent = n;
    cell.onclick = () => einClick(i);
    grid.appendChild(cell);
  });
}

function einClick(i) {
  if (einFound.includes(i)) return;
  if (einSelected.includes(i)) {
    einSelected = einSelected.filter(s => s !== i);
  } else {
    einSelected.push(i);
  }
  if (einSelected.length === 2) {
    const [a, b] = einSelected;
    if (einNumbers[a] + einNumbers[b] === einTarget) {
      einFound.push(a, b);
      einSelected = [];
      document.getElementById('einResult').innerHTML = `<span style="color:var(--accent2)">‚úÖ Found a pair! ${einNumbers[a]} + ${einNumbers[b]} = ${einTarget}</span>`;
      if (einFound.length >= 6) {
        document.getElementById('einRevealBtn').style.display = '';
      }
    } else {
      document.getElementById('einResult').innerHTML = `<span style="color:var(--accent3)">‚ùå ${einNumbers[a]} + ${einNumbers[b]} = ${einNumbers[a]+einNumbers[b]}, not ${einTarget}</span>`;
      const cells = document.getElementById('einPuzzle').children;
      einSelected.forEach(s => cells[s] && cells[s].classList.add('wrong'));
      setTimeout(() => { einSelected = []; renderEin(); }, 600);
      return;
    }
  }
  renderEin();
}

function einReveal() {
  // Find all remaining pairs
  for (let i = 0; i < einNumbers.length; i++) {
    for (let j = i + 1; j < einNumbers.length; j++) {
      if (!einFound.includes(i) && !einFound.includes(j) && einNumbers[i] + einNumbers[j] === einTarget) {
        einFound.push(i, j);
      }
    }
  }
  renderEin();
  document.getElementById('einResult').innerHTML = '<span style="color:var(--accent2)">üßò Stepping back reveals pairs you missed! Diffuse mode breaks the Einstellung block.</span>';
  einTrickyFound = true;
}

function einReset() { einInit(); }

// ===== 5. POMODORO =====
let pomoInterval = null;
let pomoSeconds = 60; // 1 min demo
let pomoTotal = 60;
let pomoRunning = false;
let pomoBreak = false;

function pomoToggle() {
  if (pomoRunning) {
    clearInterval(pomoInterval);
    pomoRunning = false;
    document.getElementById('pomoBtn').textContent = 'Resume üçÖ';
  } else {
    pomoRunning = true;
    document.getElementById('pomoBtn').textContent = 'Pause';
    pomoInterval = setInterval(pomoTick, 1000);
  }
}

function pomoTick() {
  pomoSeconds--;
  if (pomoSeconds < 0) {
    clearInterval(pomoInterval);
    pomoRunning = false;
    if (!pomoBreak) {
      // Switch to break
      pomoBreak = true;
      pomoSeconds = 15; pomoTotal = 15;
      document.getElementById('pomoTimer').classList.add('break-mode');
      document.getElementById('pomoBar').classList.add('break-mode');
      document.getElementById('pomoStatus').textContent = 'üéâ Time for a break! Let diffuse mode work.';
      document.getElementById('pomoBtn').textContent = 'Start Break üåä';
    } else {
      pomoBreak = false;
      pomoSeconds = 60; pomoTotal = 60;
      document.getElementById('pomoTimer').classList.remove('break-mode');
      document.getElementById('pomoBar').classList.remove('break-mode');
      document.getElementById('pomoStatus').textContent = 'Break over! Ready for another round.';
      document.getElementById('pomoBtn').textContent = 'Start Focus üçÖ';
    }
  }
  updatePomoDisplay();
}

function updatePomoDisplay() {
  const m = Math.floor(pomoSeconds / 60);
  const s = pomoSeconds % 60;
  document.getElementById('pomoTimer').textContent = `${m}:${s.toString().padStart(2,'0')}`;
  document.getElementById('pomoBar').style.width = ((pomoTotal - pomoSeconds) / pomoTotal * 100) + '%';
}

function pomoReset() {
  clearInterval(pomoInterval);
  pomoRunning = false; pomoBreak = false;
  pomoSeconds = 60; pomoTotal = 60;
  updatePomoDisplay();
  document.getElementById('pomoTimer').classList.remove('break-mode');
  document.getElementById('pomoBar').classList.remove('break-mode');
  document.getElementById('pomoStatus').textContent = 'Focus on process, not product.';
  document.getElementById('pomoBtn').textContent = 'Start Focus üçÖ';
}

// ===== 6. ILLUSIONS OF COMPETENCE =====
const illusionQuestions = [
  {
    fact: "Working memory can hold about 4 chunks of information at a time.",
    q: "How many chunks can working memory hold?",
    opts: ["7 chunks", "4 chunks", "12 chunks", "2 chunks"],
    correct: 1
  },
  {
    fact: "The Einstellung effect is when an existing idea blocks you from finding a better solution.",
    q: "What does the Einstellung effect describe?",
    opts: ["Learning faster under pressure", "An existing idea blocking better solutions", "The benefit of rereading material", "Memory consolidation during sleep"],
    correct: 1
  },
  {
    fact: "Recall (retrieval practice) is far more effective for learning than passive rereading.",
    q: "Which is more effective for learning?",
    opts: ["Highlighting key passages", "Rereading multiple times", "Retrieval practice (recall)", "Listening to lectures passively"],
    correct: 2
  }
];
let illusionIdx = 0;
let illusionPhase = 'read'; // 'read' or 'quiz'

function initIllusion() {
  illusionIdx = 0;
  illusionPhase = 'read';
  renderIllusion();
}

function renderIllusion() {
  const area = document.getElementById('illusionArea');
  const q = illusionQuestions[illusionIdx];
  if (illusionPhase === 'read') {
    area.innerHTML = `
      <div class="illusion-card">
        <div style="font-size:.75rem;color:var(--dim);margin-bottom:.5rem">STEP 1: Read this fact carefully</div>
        <p style="font-size:1.1rem;font-weight:600;margin-bottom:1.5rem">"${q.fact}"</p>
        <button class="btn btn-primary" onclick="illusionToQuiz()">I've got it! Test me ‚Üí</button>
      </div>`;
  } else {
    area.innerHTML = `
      <div class="illusion-card">
        <div style="font-size:.75rem;color:var(--dim);margin-bottom:.5rem">STEP 2: Can you recall it?</div>
        <p style="font-size:1rem;font-weight:600;margin-bottom:1rem">${q.q}</p>
        <div class="illusion-options">${q.opts.map((o,i) => `<div class="illusion-opt" onclick="illusionAnswer(${i})" id="illOpt${i}">${o}</div>`).join('')}</div>
        <p id="illusionFeedback" style="margin-top:1rem;font-size:.9rem;min-height:1.5em"></p>
      </div>`;
  }
}

function illusionToQuiz() {
  illusionPhase = 'quiz';
  renderIllusion();
}

function illusionAnswer(i) {
  const q = illusionQuestions[illusionIdx];
  const fb = document.getElementById('illusionFeedback');
  document.querySelectorAll('.illusion-opt').forEach(el => el.style.pointerEvents = 'none');
  if (i === q.correct) {
    document.getElementById('illOpt'+i).classList.add('correct');
    fb.innerHTML = '<span style="color:var(--accent2)">‚úÖ Correct! Recall works. You actually knew it.</span>';
  } else {
    document.getElementById('illOpt'+i).classList.add('wrong');
    document.getElementById('illOpt'+q.correct).classList.add('correct');
    fb.innerHTML = '<span style="color:var(--accent3)">‚ùå That familiar feeling was an illusion of competence! The answer <em>looked</em> right, but recall revealed the gap.</span>';
  }
  setTimeout(() => {
    illusionIdx = (illusionIdx + 1) % illusionQuestions.length;
    illusionPhase = 'read';
    renderIllusion();
  }, 3000);
}

// ===== 7. MEMORY PALACE =====
const palaceRooms = [
  { icon: 'üö™', name: 'Front Door', concept: 'Focused Mode', detail: 'Concentrated attention' },
  { icon: 'üõãÔ∏è', name: 'Living Room', concept: 'Diffuse Mode', detail: 'Relaxed, big-picture thinking' },
  { icon: 'üç≥', name: 'Kitchen', concept: 'Chunking', detail: 'Compressing ideas into units' },
  { icon: 'üìö', name: 'Study', concept: 'Recall', detail: 'Retrieval beats rereading' },
  { icon: 'üõÅ', name: 'Bathroom', concept: 'Einstellung', detail: 'Mindset blocks solutions' },
  { icon: 'üõèÔ∏è', name: 'Bedroom', concept: 'Sleep', detail: 'Brain cleans & consolidates' },
  { icon: 'üèãÔ∏è', name: 'Garage', concept: 'Deliberate Practice', detail: 'Focus on the hard parts' },
  { icon: 'üå≥', name: 'Garden', concept: 'Pomodoro', detail: '25 min focus ‚Üí reward' },
];

function initPalace() {
  const grid = document.getElementById('palaceGrid');
  grid.innerHTML = '';
  palaceRooms.forEach((r, i) => {
    const room = document.createElement('div');
    room.className = 'palace-room';
    room.innerHTML = `<div class="room-icon">${r.icon}</div><div class="room-name">${r.name}</div><div class="room-item">${r.concept}</div>`;
    room.onclick = () => {
      room.classList.toggle('revealed');
    };
    grid.appendChild(room);
  });
}

function palaceReset() {
  document.querySelectorAll('.palace-room').forEach(r => r.classList.remove('revealed'));
  document.getElementById('palaceResult').textContent = '';
}

function palaceTest() {
  // Hide all, then ask user to recall
  document.querySelectorAll('.palace-room').forEach(r => r.classList.remove('revealed'));
  document.getElementById('palaceResult').innerHTML = '<span style="color:var(--accent)">All hidden! Can you remember what\'s behind each door? Click to check yourself.</span>';
}

// ===== INIT =====
function init() {
  createBumpers();
  createBall();
  animateBall();
  initChunks();
  einInit();
  updatePomoDisplay();
  initIllusion();
  initPalace();
  
  // Re-init pinball on resize
  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
      cancelAnimationFrame(animFrame);
      createBumpers();
      createBall();
      animateBall();
    }, 300);
  });
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
