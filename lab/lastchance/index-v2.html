<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Last Chance to See ‚Äî Douglas Adams ¬∑ V2</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#060d10;--bg2:#0c1a20;--bg3:#122830;--accent:#3dd6c8;--accent2:#2ba89d;
--text:#d4e4e8;--text2:#7a9aa5;--gold:#e8c547;--warm:#e8a247;--danger:#e85c47;
--hope:#4ecb71;--gone:#e85c47;
--font:'Georgia','Times New Roman',serif;--mono:'Courier New',monospace;
}
html{scroll-behavior:smooth;font-size:16px}
body{background:var(--bg);color:var(--text);font-family:var(--font);line-height:1.7;overflow-x:hidden}
::selection{background:var(--accent);color:var(--bg)}

/* NAV */
nav{position:sticky;top:0;z-index:100;background:rgba(6,13,16,.92);backdrop-filter:blur(16px);
border-bottom:1px solid rgba(61,214,200,.1);padding:.5rem .8rem;display:flex;gap:.3rem;
flex-wrap:wrap;justify-content:center}
nav a{color:var(--text2);text-decoration:none;font-size:.75rem;padding:.25rem .5rem;border-radius:4px;
transition:all .2s;white-space:nowrap;letter-spacing:.02em}
nav a:hover,nav a.active{color:var(--accent);background:rgba(61,214,200,.08)}

/* SECTIONS */
section{max-width:900px;margin:0 auto;padding:5rem 1.5rem 3rem}
.section-divider{width:60px;height:1px;background:var(--accent2);margin:0 auto 2rem;opacity:.4}
h2{font-size:2rem;color:var(--accent);margin-bottom:.3rem;letter-spacing:-.02em;font-weight:normal}
.subtitle{color:var(--text2);font-size:1rem;margin-bottom:2rem;font-style:italic;line-height:1.6}
.quote{border-left:3px solid var(--accent2);padding:.8rem 1.2rem;margin:1.5rem 0;
background:rgba(61,214,200,.03);font-style:italic;color:var(--text)}
.quote cite{display:block;margin-top:.5rem;font-style:normal;font-size:.85rem;color:var(--text2)}
.btn{display:inline-block;padding:.6rem 1.5rem;background:transparent;border:1px solid var(--accent2);
color:var(--accent);border-radius:6px;font-family:var(--font);font-size:.95rem;cursor:pointer;transition:all .2s}
.btn:hover{background:rgba(61,214,200,.1);border-color:var(--accent)}
.btn.primary{background:var(--accent2);color:var(--bg);border-color:var(--accent2)}
.btn.primary:hover{background:var(--accent)}
.btn:disabled{opacity:.3;cursor:default}

/* HERO */
#hero{text-align:center;padding:8rem 1.5rem 5rem;max-width:900px;margin:0 auto;position:relative}
#hero h1{font-size:3rem;color:var(--accent);letter-spacing:-.03em;margin-bottom:.3rem;font-weight:normal}
#hero .author{color:var(--gold);font-size:1.1rem;margin-bottom:2rem;font-weight:normal}
#hero .tagline{color:var(--text2);font-size:1.05rem;max-width:620px;margin:0 auto 1.5rem;line-height:1.9}
#hero .epigraph{color:var(--text);font-style:italic;font-size:1.15rem;max-width:550px;margin:0 auto 2.5rem;line-height:1.8}
.hero-note{color:var(--text2);font-size:.85rem;opacity:.6}

/* ============ 1. SPECIES STATUS TRACKER ============ */
.timeline-species{margin:1.5rem 0}
.timeline-row{display:grid;grid-template-columns:180px 1fr;gap:1rem;align-items:start;
padding:1.2rem;margin-bottom:.5rem;background:var(--bg2);border-radius:10px;border:1px solid rgba(61,214,200,.08);
cursor:pointer;transition:all .3s}
.timeline-row:hover{border-color:rgba(61,214,200,.2)}
.timeline-row.open{border-color:var(--accent2)}
.tl-name{font-size:1.05rem;color:var(--accent)}
.tl-latin{font-size:.75rem;color:var(--text2);font-style:italic}
.tl-status{display:flex;align-items:center;gap:.6rem;flex-wrap:wrap}
.tl-badge{display:inline-block;padding:.2rem .6rem;border-radius:4px;font-size:.8rem;font-weight:bold}
.tl-badge.extinct{background:rgba(232,92,71,.15);color:var(--gone)}
.tl-badge.critical{background:rgba(232,162,71,.15);color:var(--warm)}
.tl-badge.endangered{background:rgba(232,197,71,.15);color:var(--gold)}
.tl-badge.recovering{background:rgba(78,203,113,.15);color:var(--hope)}
.tl-arrow{color:var(--text2);font-size:.9rem}
.tl-detail{display:none;grid-column:1/-1;padding-top:1rem;border-top:1px solid rgba(61,214,200,.06);
margin-top:.8rem;font-size:.9rem;line-height:1.7}
.timeline-row.open .tl-detail{display:block}
.tl-bar-wrap{height:6px;background:rgba(255,255,255,.05);border-radius:3px;margin:.6rem 0;overflow:hidden}
.tl-bar{height:100%;border-radius:3px;transition:width 1s ease}
.tl-numbers{display:flex;justify-content:space-between;font-size:.8rem;color:var(--text2)}
.tl-adams{margin-top:.8rem;font-style:italic;color:var(--text2);font-size:.9rem;border-left:2px solid var(--accent2);padding-left:.8rem}

/* ============ 2. BAIJI'S LAST RIVER ============ */
#baiji-river{background:var(--bg)}
.river-canvas-wrap{position:relative;width:100%;max-width:800px;margin:0 auto;border-radius:12px;overflow:hidden;
border:1px solid rgba(61,214,200,.1)}
#river-canvas{width:100%;display:block;background:#080e12;cursor:pointer}
.river-hud{position:absolute;top:12px;left:12px;right:12px;display:flex;justify-content:space-between;
pointer-events:none;font-family:var(--mono);font-size:.8rem}
.river-hud span{background:rgba(0,0,0,.5);padding:.3rem .6rem;border-radius:4px}
#river-year{color:var(--gold)}
#river-noise{color:var(--danger)}
#river-status{color:var(--accent)}
.river-controls{text-align:center;margin-top:1rem}
#river-message{text-align:center;margin-top:1rem;font-style:italic;color:var(--text2);min-height:3rem;
font-size:.95rem;transition:opacity .5s}

/* ============ 3. KAKAPO DATING SHOW ============ */
#kakapo-dating{background:var(--bg)}
.dating-stage{max-width:700px;margin:0 auto;min-height:350px;position:relative}
.dating-card{background:var(--bg2);border:1px solid rgba(61,214,200,.1);border-radius:12px;padding:1.5rem;
margin-bottom:1rem;transition:all .3s}
.dating-narrator{font-style:italic;color:var(--text2);margin-bottom:1rem;font-size:.95rem;line-height:1.7}
.dating-scene{color:var(--text);margin-bottom:1rem;font-size:.95rem;line-height:1.7}
.dating-choices{display:flex;flex-direction:column;gap:.5rem;margin-top:1rem}
.dating-choice{text-align:left;padding:.7rem 1rem;background:var(--bg3);border:1px solid rgba(61,214,200,.12);
border-radius:8px;color:var(--text);font-family:var(--font);font-size:.9rem;cursor:pointer;transition:all .2s}
.dating-choice:hover{border-color:var(--accent);background:rgba(61,214,200,.05)}
.dating-result{margin-top:1rem;padding:1rem;border-radius:8px;font-size:.9rem;line-height:1.7}
.dating-result.fail{background:rgba(232,162,71,.08);border-left:3px solid var(--warm)}
.dating-result.tragic{background:rgba(232,92,71,.08);border-left:3px solid var(--danger)}
.dating-counter{text-align:center;color:var(--gold);font-size:.9rem;margin-bottom:1rem}
.dating-kakapo-count{text-align:center;color:var(--text2);font-size:.85rem;margin-top:1rem}

/* ============ 4. OBSERVATION LENS ============ */
#observation-lens{background:var(--bg)}
.lens-example{margin:1.5rem 0;background:var(--bg2);border-radius:12px;overflow:hidden;
border:1px solid rgba(61,214,200,.08)}
.lens-toggle{display:flex;border-bottom:1px solid rgba(61,214,200,.08)}
.lens-btn{flex:1;padding:.7rem;text-align:center;cursor:pointer;font-size:.85rem;
color:var(--text2);transition:all .2s;border-bottom:2px solid transparent;font-family:var(--font)}
.lens-btn.active{color:var(--accent);border-bottom-color:var(--accent)}
.lens-btn:hover{color:var(--text)}
.lens-content{padding:1.5rem;font-size:.95rem;min-height:180px;line-height:1.8;transition:opacity .3s}
.lens-label{font-size:.7rem;text-transform:uppercase;letter-spacing:.12em;margin-bottom:.8rem;font-weight:bold}
.lens-label.plain{color:var(--text2)}
.lens-label.adams{color:var(--gold)}
.lens-label.reveal{color:var(--accent)}

/* ============ 5. KOMODO ENCOUNTER ============ */
#komodo-encounter{background:var(--bg)}
.komodo-canvas-wrap{position:relative;width:100%;max-width:800px;margin:0 auto;border-radius:12px;overflow:hidden;
border:1px solid rgba(61,214,200,.1)}
#komodo-canvas{width:100%;display:block;background:#0a0e06;cursor:pointer}
#komodo-text{text-align:center;margin-top:1rem;font-style:italic;color:var(--text2);min-height:3rem;
font-size:.95rem;line-height:1.6;transition:opacity .5s}

/* ============ 6. AYE-AYE'S FINGER ============ */
#ayeaye-finger{background:var(--bg)}
.ayeaye-canvas-wrap{position:relative;width:100%;max-width:800px;margin:0 auto;border-radius:12px;overflow:hidden;
border:1px solid rgba(61,214,200,.1)}
#ayeaye-canvas{width:100%;display:block;background:#0a0806;cursor:pointer}
#ayeaye-text{text-align:center;margin-top:1rem;color:var(--text2);min-height:2.5rem;font-size:.9rem}
.ayeaye-score{text-align:center;color:var(--gold);font-size:.9rem;margin-top:.5rem}

/* ============ 7. CONSERVATION OUTCOMES ============ */
#conservation-map{background:var(--bg)}
.outcome-map{position:relative;width:100%;max-width:800px;margin:0 auto;aspect-ratio:2/1;
background:var(--bg2);border-radius:12px;border:1px solid rgba(61,214,200,.1);overflow:hidden}
.outcome-map svg{width:100%;height:100%}
.outcome-dot{cursor:pointer;transition:all .3s}
.outcome-dot circle{transition:all .3s}
.outcome-dot:hover circle{r:10;opacity:1}
.outcome-dot text{fill:var(--text);font-size:8px;font-family:var(--font);pointer-events:none;opacity:.7}
.outcome-info{background:var(--bg2);border:1px solid rgba(61,214,200,.1);border-radius:10px;
padding:1.5rem;margin-top:1rem;min-height:120px}
.outcome-info h3{color:var(--accent);margin:0 0 .3rem;font-size:1.1rem;font-weight:normal}
.outcome-info .outcome-status{font-size:.85rem;margin-bottom:.8rem}
.outcome-hope{color:var(--hope)}
.outcome-gone{color:var(--gone)}
.outcome-mixed{color:var(--warm)}
.outcome-adams-note{margin-top:1rem;padding:1rem;background:rgba(61,214,200,.03);border-radius:8px;
font-style:italic;font-size:.9rem;color:var(--text2);line-height:1.7}

footer{text-align:center;padding:4rem 1.5rem 3rem;color:var(--text2);font-size:.85rem;
border-top:1px solid rgba(61,214,200,.06);max-width:900px;margin:0 auto;line-height:1.8}

@media(max-width:600px){
  #hero h1{font-size:2rem}
  h2{font-size:1.5rem}
  section{padding:3rem 1rem 2rem}
  .timeline-row{grid-template-columns:1fr;gap:.4rem}
  nav a{font-size:.65rem;padding:.2rem .35rem}
}
</style>
</head>
<body>

<nav>
  <a href="#hero">Home</a>
  <a href="#species-tracker">üìä Status</a>
  <a href="#baiji-river">üê¨ Baiji</a>
  <a href="#kakapo-dating">ü¶ú Kakapo</a>
  <a href="#observation-lens">üîç Lens</a>
  <a href="#komodo-encounter">ü¶é Komodo</a>
  <a href="#ayeaye-finger">üñêÔ∏è Aye-Aye</a>
  <a href="#conservation-map">üåç Outcomes</a>
</nav>

<!-- HERO -->
<section id="hero">
  <h1>Last Chance to See</h1>
  <div class="author">Douglas Adams &amp; Mark Carwardine ¬∑ 1990</div>
  <div class="epigraph">"Human beings, who are almost unique in having the ability to learn
  from the experience of others, are also remarkable for their apparent disinclination to do so."</div>
  <div class="tagline">
    In 1990, a science fiction writer and a zoologist went looking for the world's rarest animals.<br>
    Some of those animals made it. Some didn't.<br>
    Adams died in 2001. He never saw the worst of it.
  </div>
</section>

<!-- 1. SPECIES STATUS TRACKER -->
<section id="species-tracker">
  <div class="section-divider"></div>
  <h2>üìä Species Status Tracker</h2>
  <p class="subtitle">1990 vs now. Real numbers. Click each species to see what happened.</p>
  <div class="timeline-species" id="timeline-species"></div>
</section>

<!-- 2. THE BAIJI'S LAST RIVER -->
<section id="baiji-river">
  <div class="section-divider"></div>
  <h2>üê¨ The Baiji's Last River</h2>
  <p class="subtitle">Navigate the Yangtze. Listen for the dolphin. The river gets louder. The dolphin gets quieter.</p>
  <div class="river-canvas-wrap">
    <canvas id="river-canvas" width="800" height="400"></canvas>
    <div class="river-hud">
      <span id="river-year">1990</span>
      <span id="river-noise">Noise: ‚ñÆ‚ñÆ‚ñØ‚ñØ‚ñØ‚ñØ‚ñØ‚ñØ</span>
      <span id="river-status">Searching...</span>
    </div>
  </div>
  <div class="river-controls">
    <button class="btn primary" id="river-start" onclick="startRiver()">Enter the river</button>
  </div>
  <div id="river-message">"I tried to imagine what it would be like to be a blind man trying to live in a discotheque."</div>
</section>

<!-- 3. KAKAPO DATING SHOW -->
<section id="kakapo-dating">
  <div class="section-divider"></div>
  <h2>ü¶ú The Kakapo Dating Show</h2>
  <p class="subtitle">You're a conservationist. Your job: get two kakapos to mate. How hard can it be?</p>
  <div class="dating-counter" id="dating-counter">Attempts: 0 ¬∑ Successful matings: 0</div>
  <div class="dating-stage" id="dating-stage"></div>
  <div class="dating-kakapo-count" id="kakapo-population"></div>
</section>

<!-- 4. ADAMS' OBSERVATION LENS -->
<section id="observation-lens">
  <div class="section-divider"></div>
  <h2>üîç Adams' Observation Lens</h2>
  <p class="subtitle">The same scene. Two versions. His superpower was noticing what everyone else walked past.</p>
  <div id="lens-examples"></div>
</section>

<!-- 5. THE KOMODO ENCOUNTER -->
<section id="komodo-encounter">
  <div class="section-divider"></div>
  <h2>ü¶é The Komodo Encounter</h2>
  <p class="subtitle">Walk through tall grass. Something follows. Adams built tension through absurdity: the dragon is ridiculous AND terrifying.</p>
  <div class="komodo-canvas-wrap">
    <canvas id="komodo-canvas" width="800" height="400"></canvas>
  </div>
  <div style="text-align:center;margin-top:1rem">
    <button class="btn primary" id="komodo-start" onclick="startKomodo()">Enter the grass</button>
  </div>
  <div id="komodo-text"></div>
</section>

<!-- 6. THE AYE-AYE'S FINGER -->
<section id="ayeaye-finger">
  <div class="section-divider"></div>
  <h2>üñêÔ∏è The Aye-Aye's Finger</h2>
  <p class="subtitle">Tap the branches. Listen for grubs. Use evolution's weirdest solution to extract them.</p>
  <div class="ayeaye-canvas-wrap">
    <canvas id="ayeaye-canvas" width="800" height="400"></canvas>
  </div>
  <div id="ayeaye-text">Tap on the branches to listen for grubs.</div>
  <div class="ayeaye-score" id="ayeaye-score">Grubs found: 0</div>
</section>

<!-- 7. CONSERVATION OUTCOMES -->
<section id="conservation-map">
  <div class="section-divider"></div>
  <h2>üåç Conservation Outcomes</h2>
  <p class="subtitle">What happened since 1990. Click each location. Some hope, some devastation.<br>
  Adams died in 2001 ‚Äî he never saw the baiji declared extinct.</p>
  <div class="outcome-map">
    <svg viewBox="0 0 800 400" preserveAspectRatio="xMidYMid meet">
      <rect width="800" height="400" fill="var(--bg2)"/>
      <!-- Continent hints -->
      <ellipse cx="200" cy="170" rx="100" ry="80" fill="rgba(61,214,200,.02)"/>
      <ellipse cx="380" cy="160" rx="70" ry="55" fill="rgba(61,214,200,.02)"/>
      <ellipse cx="380" cy="250" rx="50" ry="70" fill="rgba(61,214,200,.02)"/>
      <ellipse cx="520" cy="170" rx="90" ry="60" fill="rgba(61,214,200,.02)"/>
      <ellipse cx="600" cy="220" rx="50" ry="40" fill="rgba(61,214,200,.02)"/>
      <ellipse cx="660" cy="330" rx="35" ry="20" fill="rgba(61,214,200,.02)"/>
      <!-- Grid -->
      <line x1="0" y1="200" x2="800" y2="200" stroke="rgba(61,214,200,.04)" stroke-width=".5"/>
      <line x1="400" y1="0" x2="400" y2="400" stroke="rgba(61,214,200,.04)" stroke-width=".5"/>

      <g class="outcome-dot" onclick="showOutcome(0)"><circle cx="420" cy="260" r="7" fill="#e8a247" opacity=".7"/><text x="432" y="264">Madagascar</text></g>
      <g class="outcome-dot" onclick="showOutcome(1)"><circle cx="560" cy="230" r="7" fill="#4ecb71" opacity=".7"/><text x="572" y="234">Komodo</text></g>
      <g class="outcome-dot" onclick="showOutcome(2)"><circle cx="670" cy="330" r="7" fill="#4ecb71" opacity=".7"/><text x="640" y="348">New Zealand</text></g>
      <g class="outcome-dot" onclick="showOutcome(3)"><circle cx="530" cy="170" r="7" fill="#e85c47" opacity=".7"/><text x="542" y="168">Yangtze</text></g>
      <g class="outcome-dot" onclick="showOutcome(4)"><circle cx="380" cy="220" r="7" fill="#e85c47" opacity=".7"/><text x="340" y="216">Congo</text></g>
      <g class="outcome-dot" onclick="showOutcome(5)"><circle cx="400" cy="200" r="7" fill="#4ecb71" opacity=".7"/><text x="412" y="198">Virungas</text></g>
      <g class="outcome-dot" onclick="showOutcome(6)"><circle cx="440" cy="270" r="7" fill="#e8a247" opacity=".7"/><text x="452" y="274">Mauritius</text></g>
    </svg>
  </div>
  <div class="outcome-info" id="outcome-info">
    <p style="color:var(--text2);text-align:center;padding:1.5rem 0">Click a location to see what happened.</p>
  </div>
</section>

<footer>
  <p>Douglas Adams died on 11 May 2001, aged 49.<br>
  The baiji was declared functionally extinct in 2006.<br>
  The last two northern white rhinos are both female.<br>
  The kakapo population just passed 250.</p>
  <p style="margin-top:1rem;opacity:.5">Built from <em>Last Chance to See</em> (1990). The world is poorer without him in it.</p>
</footer>

<script>
// ============ 1. SPECIES STATUS TRACKER ============
const speciesTimeline = [
  {
    name:'Aye-aye',latin:'Daubentonia madagascariensis',location:'Madagascar',
    status1990:'Endangered',pop1990:'~1,000 (estimated)',
    statusNow:'Endangered',popNow:'~1,000‚Äì2,000 (uncertain)',
    badge1990:'endangered',badgeNow:'endangered',
    barPct:45,barColor:'var(--warm)',
    detail:'Still endangered. Madagascar has lost 44% of its forest since Adams visited. The aye-aye survives because it\'s adaptable ‚Äî it can live in degraded forest, even plantations. But "adaptable" is a relative term when your island is being stripped bare. Locals still kill them on sight ‚Äî they believe if an aye-aye points its finger at you, you die.',
    adams:'"The aye-aye is a nocturnal lemur. It is without doubt the strangest creature I have ever seen. It looked like a very surprised cat that had been struck by lightning."'
  },
  {
    name:'Komodo dragon',latin:'Varanus komodoensis',location:'Indonesia',
    status1990:'Vulnerable',pop1990:'~5,000‚Äì8,000',
    statusNow:'Endangered (downlisted 2021)',popNow:'~3,000',
    badge1990:'endangered',badgeNow:'endangered',
    barPct:38,barColor:'var(--warm)',
    detail:'Reclassified to Endangered in 2021. Climate change models predict a 30% habitat reduction by 2050. Rising sea levels will shrink the islands. Tourism, which Adams observed already turning dragons into a sideshow, has exploded ‚Äî Komodo National Park now charges $250 entry to limit visitors. The goat-on-a-hook feeding shows have stopped, at least.',
    adams:'"It opened its eyes and had a look at me. I rocketed backwards with a yell of astonishment."'
  },
  {
    name:'Kakapo',latin:'Strigops habroptilus',location:'New Zealand',
    status1990:'Critically endangered',pop1990:'~40',
    statusNow:'Critically endangered (recovering)',popNow:'252 (as of 2024)',
    badge1990:'critical',badgeNow:'recovering',
    barPct:80,barColor:'var(--hope)',
    detail:'The great success story. From 40 birds to 252, each one named, GPS-tracked, and individually managed. Every egg is monitored. Predator-free islands. Supplementary feeding during breeding years. It has taken thirty years of obsessive, hands-on, bird-by-bird conservation. The kakapo still breeds agonisingly slowly, still booms into hillsides in the wrong direction, still has no idea what a predator is. But there are 252 of them now. Adams would have loved that.',
    adams:'"Sadly, however, it seems that not only has the kakapo forgotten how to fly, but it has also forgotten that it has forgotten how to fly."'
  },
  {
    name:'Baiji',latin:'Lipotes vexillifer',location:'Yangtze River, China',
    status1990:'Endangered',pop1990:'~200',
    statusNow:'Functionally extinct (declared 2006)',popNow:'0',
    badge1990:'endangered',badgeNow:'extinct',
    barPct:0,barColor:'var(--gone)',
    detail:'Gone. A 2006 survey of the entire Yangtze found nothing. Twenty-five million years of evolution, erased. The baiji was the first cetacean driven to extinction by human activity. Adams wrote about it navigating by echolocation in a river being filled with engine noise. He compared it to "a blind man trying to live in a discotheque." The discotheque won. No one even noticed when the music stopped.',
    adams:'"The Yangtze river dolphin is probably the most endangered species on the planet. And nobody gives a damn."'
  },
  {
    name:'Northern white rhino',latin:'Ceratotherium simum cottoni',location:'Congo/Kenya',
    status1990:'Critically endangered',pop1990:'~22',
    statusNow:'Functionally extinct',popNow:'2 (both female)',
    badge1990:'critical',badgeNow:'extinct',
    barPct:2,barColor:'var(--gone)',
    detail:'Two remain. Najin and Fatu, both female, both at Ol Pejeta Conservancy in Kenya, guarded 24/7 by armed rangers. The last male, Sudan, died in 2018. Scientists are attempting IVF using frozen sperm and southern white rhino surrogates, but it\'s a Hail Mary. Adams wrote that the difference between a rhino living and dying was "actually about twelve dollars" ‚Äî what a poacher got for a horn. The horns ended up as Yemeni dagger handles. Fashion killed them.',
    adams:'"So the difference between life or death for one of the rarest and most magnificent animals in the world is actually about twelve dollars."'
  },
  {
    name:'Mountain gorilla',latin:'Gorilla beringei beringei',location:'Virunga Mountains',
    status1990:'Critically endangered',pop1990:'~280',
    statusNow:'Endangered (improving)',popNow:'~1,060 (2023 census)',
    badge1990:'critical',badgeNow:'recovering',
    barPct:75,barColor:'var(--hope)',
    detail:'A genuine recovery. From 280 to over 1,000. Tourism revenue ‚Äî the thing Adams helped pioneer by writing about them ‚Äî became the economic argument for protection. Each gorilla family generates millions in tourist dollars. The Virungas survived two wars. Rangers died protecting them. The gorillas made it through. Adams sat eighteen inches from a silverback who touched his pen. That gorilla\'s descendants are still up there.',
    adams:'"He reached out and touched first the paper and then the top of my biro. Not to take it away from me. Just to see what it was."'
  }
];

(function(){
  const container = document.getElementById('timeline-species');
  speciesTimeline.forEach((sp,i) => {
    const row = document.createElement('div');
    row.className = 'timeline-row';
    row.onclick = () => row.classList.toggle('open');
    row.innerHTML = `
      <div>
        <div class="tl-name">${sp.name}</div>
        <div class="tl-latin">${sp.latin}</div>
        <div style="margin-top:.4rem;font-size:.8rem;color:var(--text2)">${sp.location}</div>
      </div>
      <div>
        <div class="tl-status">
          <span class="tl-badge ${sp.badge1990}">${sp.status1990}</span>
          <span class="tl-arrow">‚Üí</span>
          <span class="tl-badge ${sp.badgeNow}">${sp.statusNow}</span>
        </div>
        <div class="tl-numbers" style="margin-top:.4rem">
          <span>1990: ${sp.pop1990}</span>
          <span>Now: ${sp.popNow}</span>
        </div>
        <div class="tl-bar-wrap"><div class="tl-bar" style="width:${sp.barPct}%;background:${sp.barColor}"></div></div>
        <div class="tl-detail">
          <p>${sp.detail}</p>
          <div class="tl-adams">${sp.adams}</div>
        </div>
      </div>`;
    container.appendChild(row);
  });
})();

// ============ 2. BAIJI'S LAST RIVER ============
const riverCanvas = document.getElementById('river-canvas');
const rCtx = riverCanvas.getContext('2d');
let riverRunning = false;
let riverPhase = 0; // 0-100
let riverAnim = null;
let riverParticles = [];
let riverPings = [];
let riverBoats = [];

const riverMessages = [
  {at:0, text:'"The Yangtze river dolphin probably separated from all other dolphins about twenty million years ago."'},
  {at:10, text:'You listen. Beneath the muddy water: a faint click. Click-click. The baiji\'s echolocation. Finding its way.'},
  {at:20, text:'A few boats pass overhead. The dolphin dives, waits, surfaces behind them. It knows this trick.'},
  {at:35, text:'The engines are getting louder. Diesel. Container ships. The clicks have to compete.'},
  {at:50, text:'"I tried to imagine what it would be like to be a blind man trying to live in a discotheque."'},
  {at:65, text:'The sonar pings are fainter now. Harder to pick out. The river is a wall of sound.'},
  {at:78, text:'Was that a ping? Or just engine noise reflected off the hull of a barge? You can\'t tell anymore.'},
  {at:88, text:'The noise is continuous. A sustained shrieking blast in which nothing can be made out.'},
  {at:95, text:'Silence. Not the river\'s silence ‚Äî that\'s louder than ever. The dolphin\'s silence.'},
  {at:100,text:'In 2006, a six-week survey of the entire Yangtze found nothing. Twenty-five million years of evolution. Gone.'}
];

function startRiver(){
  if(riverRunning) return;
  riverRunning = true;
  riverPhase = 0;
  document.getElementById('river-start').disabled = true;
  document.getElementById('river-start').textContent = 'Listening...';
  riverParticles = [];
  riverBoats = [];
  for(let i=0;i<60;i++) riverParticles.push({x:Math.random()*800,y:Math.random()*400,vx:-.3-Math.random()*.5,vy:(Math.random()-.5)*.2,s:1+Math.random()*2,a:.1+Math.random()*.2});
  animateRiver();
}

function animateRiver(){
  if(!riverRunning) return;
  riverPhase += 0.06;
  if(riverPhase > 102) { riverPhase = 102; riverRunning = false;
    document.getElementById('river-start').disabled = false;
    document.getElementById('river-start').textContent = 'Enter the river again';
    return;
  }
  const w=riverCanvas.width, h=riverCanvas.height;
  const noise = Math.min(1, riverPhase/100);
  const dolphinPresence = Math.max(0, 1 - (riverPhase/85));

  // Background ‚Äî gets murkier
  const g = rCtx.createLinearGradient(0,0,0,h);
  g.addColorStop(0, `rgba(${8+noise*15},${14+noise*5},${20-noise*10},1)`);
  g.addColorStop(1, `rgba(${5+noise*20},${10+noise*8},${15-noise*5},1)`);
  rCtx.fillStyle = g;
  rCtx.fillRect(0,0,w,h);

  // Water current particles
  riverParticles.forEach(p => {
    p.x += p.vx*(1+noise); p.y += p.vy;
    if(p.x < -5) p.x = w+5;
    if(p.y < 0 || p.y > h) p.vy *= -1;
    rCtx.beginPath();
    rCtx.arc(p.x,p.y,p.s,0,Math.PI*2);
    rCtx.fillStyle = `rgba(61,214,200,${p.a*(1-noise*.7)})`;
    rCtx.fill();
  });

  // Sonar pings from dolphin
  if(dolphinPresence > 0.05){
    const pingInterval = 40 + (1-dolphinPresence)*100;
    if(Math.random() < dolphinPresence * 0.04){
      const dx = 350 + (Math.random()-.5)*200;
      const dy = 200 + (Math.random()-.5)*100;
      riverPings.push({x:dx,y:dy,r:0,maxR:80+Math.random()*60,a:dolphinPresence*.7});
    }
  }
  riverPings = riverPings.filter(p => {
    p.r += 1.2;
    if(p.r > p.maxR) return false;
    const a = p.a * (1 - p.r/p.maxR);
    rCtx.beginPath();
    rCtx.arc(p.x,p.y,p.r,0,Math.PI*2);
    rCtx.strokeStyle = `rgba(61,214,200,${a})`;
    rCtx.lineWidth = 2;
    rCtx.stroke();
    return true;
  });

  // Dolphin silhouette (fades out)
  if(dolphinPresence > 0.1){
    const dx = 350 + Math.sin(riverPhase*.3)*40;
    const dy = 200 + Math.cos(riverPhase*.2)*20;
    rCtx.save();
    rCtx.globalAlpha = dolphinPresence * .25;
    rCtx.fillStyle = 'rgba(61,214,200,.6)';
    rCtx.beginPath();
    // Simple dolphin shape
    rCtx.ellipse(dx,dy,35,10,Math.sin(riverPhase*.1)*.2,0,Math.PI*2);
    rCtx.fill();
    // Fin
    rCtx.beginPath();
    rCtx.moveTo(dx-5,dy-8);
    rCtx.lineTo(dx+3,dy-18);
    rCtx.lineTo(dx+10,dy-8);
    rCtx.fill();
    // Snout
    rCtx.beginPath();
    rCtx.ellipse(dx+35,dy+2,15,4,0.1,0,Math.PI*2);
    rCtx.fill();
    rCtx.restore();
  }

  // Noise interference (boats, engine rumble)
  if(noise > 0.2){
    const boatCount = Math.floor(noise * 8);
    for(let i=0;i<boatCount;i++){
      const bx = (Date.now()/20 + i*120) % (w+100) - 50;
      const by = 30 + i*45;
      // Engine noise ripples
      const intensity = noise * .3;
      rCtx.beginPath();
      rCtx.arc(bx,by, 15+Math.sin(Date.now()/200+i)*5, 0, Math.PI*2);
      rCtx.strokeStyle = `rgba(232,92,71,${intensity*.5})`;
      rCtx.lineWidth = 1;
      rCtx.stroke();
      // Larger disturbance
      if(noise > .5){
        rCtx.beginPath();
        rCtx.arc(bx,by, 30+Math.sin(Date.now()/150+i)*10, 0, Math.PI*2);
        rCtx.strokeStyle = `rgba(232,92,71,${intensity*.25})`;
        rCtx.stroke();
      }
    }
    // Static noise overlay
    if(noise > .6){
      for(let i=0;i<noise*40;i++){
        rCtx.fillStyle = `rgba(232,92,71,${Math.random()*noise*.08})`;
        rCtx.fillRect(Math.random()*w,Math.random()*h,Math.random()*30+5,1);
      }
    }
  }

  // HUD
  const year = Math.floor(1990 + (riverPhase/100)*16);
  document.getElementById('river-year').textContent = year > 2006 ? '2006' : year;
  const noiseBars = Math.min(8, Math.floor(noise*8));
  document.getElementById('river-noise').textContent = 'Noise: ' + '‚ñÆ'.repeat(noiseBars) + '‚ñØ'.repeat(8-noiseBars);
  document.getElementById('river-noise').style.color = noise > .7 ? 'var(--danger)' : noise > .4 ? 'var(--warm)' : 'var(--text2)';

  if(dolphinPresence > .3) document.getElementById('river-status').textContent = 'Signal detected';
  else if(dolphinPresence > .1) document.getElementById('river-status').textContent = 'Signal fading...';
  else if(dolphinPresence > .01) document.getElementById('river-status').textContent = 'Signal lost?';
  else document.getElementById('river-status').textContent = 'Silence';
  document.getElementById('river-status').style.color = dolphinPresence > .1 ? 'var(--accent)' : 'var(--danger)';

  // Messages
  const msg = [...riverMessages].reverse().find(m => riverPhase >= m.at);
  if(msg) document.getElementById('river-message').textContent = msg.text;

  riverAnim = requestAnimationFrame(animateRiver);
}

// ============ 3. KAKAPO DATING SHOW ============
let datingStep = 0;
let datingAttempts = 0;
let datingMatings = 0;

const datingScenario = [
  {
    narrator:'You\'ve been assigned to Codfish Island. Your mission: get Richard Henry (male, 3.5kg, enthusiastic) to mate with Flossie (female, slightly less enthusiastic). The species has 40 members. No pressure.',
    scene:'Richard Henry has been booming for six weeks. He\'s excavated a beautiful bowl in the hillside and has been inflating himself like a feathery balloon every night, producing a deep BOOM that resonates across the valley.',
    choices:[
      {text:'Place Flossie within earshot of the booming', next:1},
      {text:'Play recorded booming sounds to attract Flossie', next:2},
      {text:'Put them in the same enclosure and hope for the best', next:3}
    ]
  },
  {
    narrator:'You place Flossie 200 metres from Richard Henry\'s boom-bowl. She can hear him. In theory.',
    scene:'The problem: the kakapo\'s boom is so low-frequency ‚Äî around 30Hz ‚Äî that it\'s essentially impossible to tell which direction it\'s coming from. Flossie walks confidently... in the opposite direction. She ends up on a beach.',
    result:'fail',
    resultText:'Flossie is now two kilometres away, investigating a rock that she finds more interesting than Richard Henry. The boom is omnidirectional. Adams wrote: she can hear him everywhere, which means she can locate him nowhere.',
    choices:[{text:'Try a different approach', next:4}]
  },
  {
    narrator:'You set up speakers playing Richard Henry\'s boom. A novel approach.',
    scene:'Richard Henry hears what he thinks is a rival male. He abandons his bowl-site, marches toward the speaker, and attempts to fight it. He falls off a ridge in the process. He\'s fine ‚Äî kakapos are surprisingly bouncy ‚Äî but he\'s now in entirely the wrong valley.',
    result:'fail',
    resultText:'Richard Henry has relocated. He\'s now booming into the side of a different hill. Flossie hasn\'t noticed. You have moved the problem, not solved it.',
    choices:[{text:'Try yet another approach', next:4}]
  },
  {
    narrator:'Direct introduction. Simple. What could go wrong?',
    scene:'Richard Henry is delighted by the company. He waddles over to Flossie and attempts to mate with her head. Flossie, unimpressed, walks away. Richard Henry, undeterred, attempts to mate with your hiking boot.',
    result:'fail',
    resultText:'One ranger famously left his hat on the ground. He came back to find a kakapo attempting to ravish it. The kakapo does not have a sophisticated approach to courtship. Or, for that matter, to species identification.',
    choices:[{text:'Regroup and try again', next:4}]
  },
  {
    narrator:'Season two. A rimu mast year ‚Äî the trees are fruiting, which triggers kakapo breeding. This only happens every 2-4 years. This is your window.',
    scene:'Richard Henry is booming again. Flossie is... actually interested this time. She\'s walking toward the boom. Sort of. She keeps stopping to eat. The rimu fruit is very distracting.',
    choices:[
      {text:'Supplement Flossie\'s diet so she doesn\'t need to forage', next:5},
      {text:'Clear a path between Flossie and Richard Henry', next:6},
      {text:'Wait patiently ‚Äî nature will take its course', next:7}
    ]
  },
  {
    narrator:'You set up feeding stations with supplementary food. Flossie eats enthusiastically. Too enthusiastically.',
    scene:'Flossie has gained 400 grams. She is now too heavy to walk comfortably to the boom-bowl. She sits near the feeding station looking satisfied. Richard Henry booms into the night, alone.',
    result:'fail',
    resultText:'This actually happened. Supplementary feeding made the females too fat to bother finding mates. Conservation is the art of solving one problem by creating three new ones.',
    choices:[{text:'Different strategy', next:8}]
  },
  {
    narrator:'You clear a path. Remove fallen branches, flatten the undergrowth. A kakapo highway.',
    scene:'A stoat uses your convenient path to reach the nesting area. Stoats are not native to New Zealand. They eat eggs. And chicks. And sometimes adult kakapos who, when confronted with a predator, freeze and hope it goes away. This is not an effective strategy against stoats.',
    result:'fail',
    resultText:'Predator traps. You need predator traps. The entire conservation programme is basically: outsmart the stoats, then outsmart the kakapos\' complete inability to recognise danger. Both are full-time jobs.',
    choices:[{text:'Try again next breeding season', next:8}]
  },
  {
    narrator:'You wait. Nature takes its course. Slowly.',
    scene:'Three months pass. Richard Henry booms every night for seven hours. Flossie wanders the island. They don\'t meet. The breeding season ends. The rimu trees stop fruiting. The window closes.',
    result:'fail',
    resultText:'The next rimu mast year is in 2-4 years. Richard Henry will boom again then. If he\'s still alive. If Flossie is still alive. If the stoats don\'t find the island. If the weather cooperates. If.',
    choices:[{text:'Try one more time...', next:8}]
  },
  {
    narrator:'Final attempt. Everything aligned: rimu mast year, predator-free island, supplementary feeding calibrated to not-too-much, tracking devices on both birds, night-vision monitoring.',
    scene:'2:47 AM. Richard Henry\'s boom echoes across the bowl. Flossie, for reasons no one fully understands, finally walks the right direction. She finds the bowl. Richard Henry displays enthusiastically.',
    choices:[
      {text:'Watch through night-vision equipment', next:9},
      {text:'Leave them alone ‚Äî any disturbance could ruin it', next:9}
    ]
  },
  {
    narrator:'They mate. It takes about twelve seconds. After seven years of booming, supplementary feeding programmes, predator eradication, GPS tracking, and the attention of several dozen conservation scientists.',
    scene:'Flossie lays one egg. You hold your breath for 30 days.',
    result:'tragic',
    resultText:'The egg is infertile. This happens about 40% of the time with kakapos. The next breeding opportunity is in 2-3 years. You have spent seven years and approximately $2 million to produce one infertile egg.',
    choices:[{text:'See the bigger picture', next:10}]
  },
  {
    narrator:'And yet.',
    scene:'There are 252 kakapos alive today. In 1990, there were 40. Every single one has a name. Every egg is monitored by hand. Some chicks are fed with eyedroppers every two hours. The programme works ‚Äî not because nature cooperates, but because people refused to give up on the world\'s fattest, friendliest, most romantically hopeless parrot.',
    result:'tragic',
    resultText:'Adams would have loved this. The bird that forgot it forgot how to fly, saved by people who refused to forget it existed. 252 and counting. Slowly. Very, very slowly.',
    choices:[]
  }
];

function renderDating(step){
  datingStep = step;
  const s = datingScenario[step];
  const stage = document.getElementById('dating-stage');
  let html = '<div class="dating-card">';
  html += `<div class="dating-narrator">${s.narrator}</div>`;
  html += `<div class="dating-scene">${s.scene}</div>`;
  if(s.result){
    datingAttempts++;
    html += `<div class="dating-result ${s.result}">${s.resultText}</div>`;
  }
  if(s.choices.length > 0){
    html += '<div class="dating-choices">';
    s.choices.forEach(c => {
      html += `<button class="dating-choice" onclick="renderDating(${c.next})">${c.text}</button>`;
    });
    html += '</div>';
  }
  html += '</div>';
  stage.innerHTML = html;
  document.getElementById('dating-counter').textContent = `Attempts: ${datingAttempts} ¬∑ Successful matings: ${datingMatings}`;
  if(step === 10){
    document.getElementById('kakapo-population').innerHTML = '<strong style="color:var(--hope)">Population in 2024: 252</strong> ¬∑ Every one of them a small, round, ground-dwelling miracle.';
  }
}
renderDating(0);

// ============ 4. OBSERVATION LENS ============
const lensData = [
  {
    title:'Encountering a Komodo Dragon',
    plain:'A large monitor lizard, approximately 3 metres in length, was resting near the path. Upon noticing the observers, it opened its eyes and remained still. The species is an ambush predator found only on several Indonesian islands.',
    adams:'"Lying on the ground in front of us was what I at first thought was a small stuffed dragon. I say small because it was only about four feet long. I was a little startled to see it for a moment, but then went up to have a look at it. It opened its eyes and had a look at me. I rocketed backwards with a yell of astonishment, which provoked barks of derisive laughter from the terrace. \'It\'s just a dragon,\' called out an American girl. \'Done the dragons. Bored with them.\'"',
    reveal:'The plain version gives you a lizard. Adams gives you the entire tourist-industrial complex in miniature: the creature reduced to entertainment, the casual boredom masking something ancient and alarming, and the absurdity of a human being startled by the thing they came to see. The comedy carries what straight description can\'t ‚Äî the dissonance between what the dragon IS and what we\'ve turned it INTO.'
  },
  {
    title:'A Rhino in the Grass',
    plain:'A northern white rhinoceros was observed at a distance of approximately 25 metres. The animal, weighing an estimated 2,300 kg, was feeding on grass. The species has nasal passages disproportionately large relative to brain size.',
    adams:'"It\'s a startling moment when you first realize that the thing you\'re looking at is a living creature, not a piece of the landscape. It moved. Huge muscles moved easily under its heavy skin like Volkswagens parking. It swung its head toward us. The nasal passages of the rhinoceros are bigger than its brain. This is not a creature that gives a lot of thought to what it\'s about to do."',
    reveal:'The plain version measures. Adams sees. "Volkswagens parking" ‚Äî suddenly you feel the weight, the mass, the slow hydraulic power of the thing. And "nasal passages bigger than its brain" isn\'t a fact about anatomy ‚Äî it\'s a window into an entirely different way of experiencing the world. The rhino doesn\'t think its way through life. It smells its way through. Adams notices the gap between our world-model and the rhino\'s, and makes you feel it.'
  },
  {
    title:'The Gorilla Encounter',
    plain:'A male mountain gorilla (silverback) was observed at close range, approximately 0.5 metres. The animal displayed no aggressive behaviour and appeared to examine the observer\'s writing implements with apparent curiosity before returning to feeding.',
    adams:'"He shifted himself away from me ‚Äî just about six inches ‚Äî as if I had sat slightly too close to him on a sofa. And I thought of what an amazingly presumptuous thing it was of us to even think of judging their intelligence. I pictured myself beside him, festooned with the apparatus of my intelligence ‚Äî Gore-Tex, pen, autofocus Nikon ‚Äî and my inability to comprehend any of the life we had left behind us in the forest."',
    reveal:'The plain version records behaviour. Adams has a crisis of identity. "Sat slightly too close on a sofa" ‚Äî with six words he bridges the species gap, makes the gorilla a person, makes you feel the social awkwardness of being a primate among primates. Then he turns it: WE are the ones festooned with apparatus, compensating with technology for everything we\'ve lost. The gorilla doesn\'t need a pen. Adams does, and knows it, and the knowing is the whole point.'
  },
  {
    title:'The Kakapo\'s Mating Call',
    plain:'Male kakapos produce a low-frequency vocalisation known as "booming" from excavated bowl-shaped depressions. The sound, at approximately 30Hz, can travel several kilometres but is difficult to localise due to its wavelength.',
    adams:'"The booming is an extraordinary noise. It\'s a deep powerful throb that resonates through the ground as much as the air. And herein lies the kakapo\'s problem. The female hears the boom everywhere. It fills the forest. It fills her with sexy feelings, but she can\'t tell where it\'s coming from. The kakapo has the best night out in the world. It just never gets a date."',
    reveal:'Both describe the same acoustic physics. The plain version explains wavelength propagation. Adams gives the kakapo a Friday night. "Fills her with sexy feelings" does more for your understanding of mating ecology than any spectrogram could. And "best night out, never gets a date" ‚Äî that\'s not anthropomorphism. It\'s empathy wielded as precision instrument.'
  }
];

(function(){
  const container = document.getElementById('lens-examples');
  lensData.forEach((ex,i) => {
    const div = document.createElement('div');
    div.className = 'lens-example';
    div.innerHTML = `
      <div style="padding:1rem 1.5rem .5rem"><strong style="color:var(--text)">${ex.title}</strong></div>
      <div class="lens-toggle">
        <div class="lens-btn active" onclick="switchLens(${i},'plain',this)">üìã Plain</div>
        <div class="lens-btn" onclick="switchLens(${i},'adams',this)">‚úçÔ∏è Adams</div>
        <div class="lens-btn" onclick="switchLens(${i},'reveal',this)">üí° What changes</div>
      </div>
      <div class="lens-content" id="lens-${i}">
        <div class="lens-label plain">Standard Description</div>
        ${ex.plain}
      </div>`;
    container.appendChild(div);
  });
})();

function switchLens(i,type,el){
  const ex = lensData[i];
  const content = document.getElementById('lens-'+i);
  el.parentElement.querySelectorAll('.lens-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  const labels = {plain:'Standard Description', adams:'Douglas Adams', reveal:'What The Lens Reveals'};
  const classes = {plain:'plain', adams:'adams', reveal:'reveal'};
  const texts = {plain:ex.plain, adams:ex.adams, reveal:ex.reveal};
  content.innerHTML = `<div class="lens-label ${classes[type]}">${labels[type]}</div>${texts[type]}`;
}

// ============ 5. KOMODO ENCOUNTER ============
const komodoCanvas = document.getElementById('komodo-canvas');
const kCtx = komodoCanvas.getContext('2d');
let komodoRunning = false;
let komodoPhase = 0;
let komodoGrass = [];
let komodoClicked = false;

const komodoTexts = [
  {at:0, text:'You step off the path. The grass is shoulder-height. Dry. Rattling.'},
  {at:8, text:'Something moves to your left. Just grass bending. Probably wind.'},
  {at:18, text:'It wasn\'t wind. The grass is parting about thirty metres away. Slowly. Deliberately.'},
  {at:28, text:'"A Komodo dragon can outrun you over a short distance. They can also climb trees. I wasn\'t sure what to do with this information."'},
  {at:40, text:'You can smell it now. A warm, rotting sweetness. Like meat left in the sun. The dragon\'s saliva contains over 50 strains of bacteria.'},
  {at:52, text:'The grass parts closer. Twenty metres. You see a flicker of something grey-brown. A tongue. Tasting the air. Tasting you.'},
  {at:62, text:'"It moved its head from side to side, not sinuously but mechanically, like a toy on wheels that had been given a shove."'},
  {at:72, text:'It steps into a clearing. Three metres long. Its eye ‚Äî nearly the same size as yours ‚Äî regards you with a slow, considered blink.'},
  {at:82, text:'It is ridiculous. It is a leftover from a B-movie. It is also, beyond any doubt, the most dangerous thing you have ever stood near.'},
  {at:92, text:'"I rocketed backwards with a yell of astonishment." And somewhere on a terrace, an American girl says: "Done the dragons. Bored with them."'},
  {at:100,text:'The dragon loses interest. It turns, unhurried, and disappears back into the grass. It was here before you. It will be here after.'}
];

// Init grass blades
for(let i=0;i<200;i++){
  komodoGrass.push({
    x: Math.random()*800,
    baseY: 180 + Math.random()*220,
    h: 60 + Math.random()*140,
    w: 2 + Math.random()*3,
    phase: Math.random()*Math.PI*2,
    speed: .5 + Math.random()
  });
}

function startKomodo(){
  if(komodoRunning) return;
  komodoRunning = true;
  komodoPhase = 0;
  document.getElementById('komodo-start').disabled = true;
  document.getElementById('komodo-start').textContent = 'Walking...';
  animateKomodo();
}

function animateKomodo(){
  if(!komodoRunning) return;
  komodoPhase += 0.04;
  if(komodoPhase > 105){
    komodoRunning = false;
    document.getElementById('komodo-start').disabled = false;
    document.getElementById('komodo-start').textContent = 'Enter the grass again';
    return;
  }

  const w=komodoCanvas.width, h=komodoCanvas.height;
  const t = Date.now()/1000;

  // Sky gradient
  const sky = kCtx.createLinearGradient(0,0,0,h);
  sky.addColorStop(0,'#1a1e10');
  sky.addColorStop(.4,'#252a15');
  sky.addColorStop(1,'#0a0e06');
  kCtx.fillStyle = sky;
  kCtx.fillRect(0,0,w,h);

  // Ground
  kCtx.fillStyle = '#1a1a0d';
  kCtx.fillRect(0,280,w,120);

  // Dragon silhouette (appears gradually)
  const dragonPresence = Math.max(0, Math.min(1, (komodoPhase-25)/50));
  if(dragonPresence > 0){
    const dx = 500 - dragonPresence*150;
    const dy = 260;
    kCtx.save();
    kCtx.globalAlpha = dragonPresence * .4;
    kCtx.fillStyle = '#3a3528';

    // Body
    kCtx.beginPath();
    kCtx.ellipse(dx,dy,60*dragonPresence,15,0,0,Math.PI*2);
    kCtx.fill();

    // Head
    kCtx.beginPath();
    kCtx.ellipse(dx+55*dragonPresence,dy-5,20*dragonPresence,10,-.1,0,Math.PI*2);
    kCtx.fill();

    // Tongue flick
    if(dragonPresence > .5 && Math.sin(t*3)>.3){
      kCtx.strokeStyle = '#e85c47';
      kCtx.lineWidth = 1.5;
      kCtx.globalAlpha = dragonPresence * .6;
      kCtx.beginPath();
      kCtx.moveTo(dx+70*dragonPresence,dy-5);
      const tongueLen = 15 + Math.sin(t*8)*5;
      kCtx.lineTo(dx+70*dragonPresence+tongueLen,dy-8+Math.sin(t*6)*3);
      kCtx.stroke();
    }

    // Eye
    if(dragonPresence > .6){
      kCtx.globalAlpha = dragonPresence * .8;
      kCtx.fillStyle = '#e8c547';
      kCtx.beginPath();
      kCtx.arc(dx+60*dragonPresence,dy-10,3,0,Math.PI*2);
      kCtx.fill();
      kCtx.fillStyle = '#000';
      kCtx.beginPath();
      kCtx.ellipse(dx+60*dragonPresence,dy-10,1.5,2.5,0,0,Math.PI*2);
      kCtx.fill();
    }

    // Tail
    kCtx.globalAlpha = dragonPresence * .3;
    kCtx.fillStyle = '#3a3528';
    kCtx.beginPath();
    kCtx.moveTo(dx-55*dragonPresence,dy);
    kCtx.quadraticCurveTo(dx-90*dragonPresence,dy+Math.sin(t)*10,dx-110*dragonPresence,dy+5);
    kCtx.lineTo(dx-110*dragonPresence,dy+8);
    kCtx.quadraticCurveTo(dx-85*dragonPresence,dy+Math.sin(t)*10+5,dx-50*dragonPresence,dy+10);
    kCtx.fill();

    kCtx.restore();
  }

  // Grass
  const dragonX = 500 - Math.max(0,Math.min(1,(komodoPhase-25)/50))*150;
  komodoGrass.forEach(g => {
    const sway = Math.sin(t*g.speed + g.phase)*8;
    // Extra sway near dragon
    let extraSway = 0;
    const distToDragon = Math.abs(g.x - dragonX);
    if(dragonPresence > .2 && distToDragon < 80){
      extraSway = (1-distToDragon/80) * dragonPresence * Math.sin(t*2+g.phase)*15;
    }

    kCtx.save();
    kCtx.translate(g.x, g.baseY);
    const green = 80 + Math.floor(Math.random()*40);
    const alpha = .4 + (g.baseY - 180)/300 * .5;
    kCtx.strokeStyle = `rgba(${40+Math.floor(g.baseY/8)},${green},${20},${alpha})`;
    kCtx.lineWidth = g.w;
    kCtx.lineCap = 'round';
    kCtx.beginPath();
    kCtx.moveTo(0,0);
    kCtx.quadraticCurveTo(sway+extraSway, -g.h/2, (sway+extraSway)*1.3, -g.h);
    kCtx.stroke();
    kCtx.restore();
  });

  // Text
  const msg = [...komodoTexts].reverse().find(m => komodoPhase >= m.at);
  if(msg) document.getElementById('komodo-text').textContent = msg.text;

  requestAnimationFrame(animateKomodo);
}

// ============ 6. AYE-AYE'S FINGER ============
const ayeCanvas = document.getElementById('ayeaye-canvas');
const aCtx = ayeCanvas.getContext('2d');
let ayeGrubs = 0;
let ayeBranches = [];
let ayeTapping = null;
let ayeExtracting = null;
let ayeRipples = [];

// Generate branches with hidden grubs
function initAyeAye(){
  ayeBranches = [];
  for(let i=0;i<6;i++){
    const y = 80 + i*55;
    const x1 = 50 + Math.random()*100;
    const x2 = 550 + Math.random()*200;
    const grubSpots = [];
    const numGrubs = 1 + Math.floor(Math.random()*3);
    for(let g=0;g<numGrubs;g++){
      grubSpots.push({
        x: x1 + Math.random()*(x2-x1),
        found:false,
        taps:0
      });
    }
    ayeBranches.push({x1,x2,y,thickness:8+Math.random()*8,grubs:grubSpots});
  }
  drawAyeAye();
}

function drawAyeAye(){
  const w=ayeCanvas.width, h=ayeCanvas.height;
  const t = Date.now()/1000;

  // Night sky
  const sky = aCtx.createLinearGradient(0,0,0,h);
  sky.addColorStop(0,'#0a0604');
  sky.addColorStop(1,'#140e08');
  aCtx.fillStyle = sky;
  aCtx.fillRect(0,0,w,h);

  // Stars
  for(let i=0;i<30;i++){
    const sx = (i*127+43)%w, sy = (i*89+17)%(h/3);
    aCtx.fillStyle = `rgba(255,255,200,${.1+Math.sin(t+i)*.1})`;
    aCtx.fillRect(sx,sy,1,1);
  }

  // Moon glow
  aCtx.save();
  const moonG = aCtx.createRadialGradient(680,50,5,680,50,80);
  moonG.addColorStop(0,'rgba(255,240,200,.15)');
  moonG.addColorStop(1,'rgba(255,240,200,0)');
  aCtx.fillStyle = moonG;
  aCtx.fillRect(600,0,180,130);
  aCtx.fillStyle = 'rgba(255,240,200,.3)';
  aCtx.beginPath();
  aCtx.arc(680,50,12,0,Math.PI*2);
  aCtx.fill();
  aCtx.restore();

  // Branches
  ayeBranches.forEach(b => {
    aCtx.save();
    // Branch body
    aCtx.strokeStyle = '#3a2a18';
    aCtx.lineWidth = b.thickness;
    aCtx.lineCap = 'round';
    aCtx.beginPath();
    aCtx.moveTo(b.x1,b.y);
    aCtx.bezierCurveTo(b.x1+(b.x2-b.x1)*.3,b.y-10,b.x1+(b.x2-b.x1)*.7,b.y+10,b.x2,b.y);
    aCtx.stroke();

    // Bark texture
    aCtx.strokeStyle = '#2a1e10';
    aCtx.lineWidth = 1;
    for(let k=0;k<8;k++){
      const kx = b.x1 + (b.x2-b.x1)*(k/8);
      aCtx.beginPath();
      aCtx.moveTo(kx,b.y-b.thickness/3);
      aCtx.lineTo(kx+10,b.y+b.thickness/3);
      aCtx.stroke();
    }

    // Found grubs (glow)
    b.grubs.forEach(g => {
      if(g.found){
        aCtx.fillStyle = 'rgba(232,197,71,.3)';
        aCtx.beginPath();
        aCtx.arc(g.x, b.y, 8, 0, Math.PI*2);
        aCtx.fill();
        aCtx.fillStyle = '#e8c547';
        aCtx.beginPath();
        // Grub shape
        aCtx.ellipse(g.x, b.y, 5, 3, 0, 0, Math.PI*2);
        aCtx.fill();
      }
    });

    aCtx.restore();
  });

  // Tap ripples (sonar visualization)
  ayeRipples = ayeRipples.filter(r => {
    r.radius += 2;
    r.alpha -= .02;
    if(r.alpha <= 0) return false;
    aCtx.beginPath();
    aCtx.arc(r.x,r.y,r.radius,0,Math.PI*2);
    aCtx.strokeStyle = r.grubNear ? `rgba(232,197,71,${r.alpha})` : `rgba(61,214,200,${r.alpha*.5})`;
    aCtx.lineWidth = r.grubNear ? 2 : 1;
    aCtx.stroke();
    return true;
  });

  // Extracting animation
  if(ayeExtracting){
    const ex = ayeExtracting;
    ex.progress += .02;
    // Draw the finger
    aCtx.save();
    aCtx.strokeStyle = '#8a7a6a';
    aCtx.lineWidth = 2;
    aCtx.beginPath();
    aCtx.moveTo(ex.x, ex.y - 30);
    aCtx.lineTo(ex.x, ex.y + Math.sin(t*10)*2);
    aCtx.stroke();
    // Fingertip
    aCtx.fillStyle = '#6a5a4a';
    aCtx.beginPath();
    aCtx.arc(ex.x, ex.y+Math.sin(t*10)*2, 2, 0, Math.PI*2);
    aCtx.fill();

    if(ex.progress > 1){
      ex.grub.found = true;
      ayeGrubs++;
      document.getElementById('ayeaye-score').textContent = `Grubs found: ${ayeGrubs}`;
      const messages = [
        'The finger goes in. The grub comes out. Evolution\'s most improbable utensil.',
        '"It looked like a very surprised cat that had been struck by lightning."',
        'Millions of years of evolution for one weird, spindly, perfect tool.',
        'Woodpeckers do this with their beaks. The aye-aye said: I\'ll use my hand.',
        'Where other animals evolved strength, the aye-aye evolved patience and a very long finger.'
      ];
      document.getElementById('ayeaye-text').textContent = messages[ayeGrubs % messages.length];
      ayeExtracting = null;
    }
    aCtx.restore();
  }

  // Aye-aye silhouette (perched, subtle)
  aCtx.save();
  aCtx.globalAlpha = .15;
  aCtx.fillStyle = '#4a3a2a';
  // Body
  aCtx.beginPath();
  aCtx.ellipse(100,65,18,12,-.2,0,Math.PI*2);
  aCtx.fill();
  // Head
  aCtx.beginPath();
  aCtx.arc(118,52,10,0,Math.PI*2);
  aCtx.fill();
  // Ears (big!)
  aCtx.beginPath();
  aCtx.ellipse(112,38,5,10,-.3,0,Math.PI*2);
  aCtx.fill();
  aCtx.beginPath();
  aCtx.ellipse(126,40,5,9,.3,0,Math.PI*2);
  aCtx.fill();
  // Eyes (big, reflective)
  aCtx.globalAlpha = .4;
  aCtx.fillStyle = '#e8c547';
  aCtx.beginPath();
  aCtx.arc(115,50,3,0,Math.PI*2);
  aCtx.fill();
  aCtx.beginPath();
  aCtx.arc(123,49,3,0,Math.PI*2);
  aCtx.fill();
  // Tail
  aCtx.globalAlpha = .1;
  aCtx.fillStyle = '#4a3a2a';
  aCtx.beginPath();
  aCtx.moveTo(82,68);
  aCtx.quadraticCurveTo(50,50+Math.sin(t)*5,40,70);
  aCtx.lineWidth = 6;
  aCtx.strokeStyle = '#4a3a2a';
  aCtx.stroke();
  aCtx.restore();

  requestAnimationFrame(drawAyeAye);
}

ayeCanvas.addEventListener('click', function(e){
  const rect = ayeCanvas.getBoundingClientRect();
  const scaleX = 800/rect.width;
  const scaleY = 400/rect.height;
  const mx = (e.clientX - rect.left)*scaleX;
  const my = (e.clientY - rect.top)*scaleY;

  // Check if near a branch
  let nearGrub = null;
  let nearBranch = null;
  ayeBranches.forEach(b => {
    if(Math.abs(my - b.y) < 20 && mx >= b.x1 && mx <= b.x2){
      b.grubs.forEach(g => {
        if(!g.found && Math.abs(mx - g.x) < 30){
          nearGrub = g;
          nearBranch = b;
        }
      });
      // Add ripple
      const isNear = b.grubs.some(g => !g.found && Math.abs(mx-g.x)<40);
      ayeRipples.push({x:mx,y:my,radius:0,alpha:.6,grubNear:isNear});

      if(!isNear){
        document.getElementById('ayeaye-text').textContent = 'Tap... tap... nothing here. Try another spot.';
      }
    }
  });

  if(nearGrub && !nearGrub.found){
    nearGrub.taps++;
    if(nearGrub.taps >= 3){
      // Extract!
      ayeExtracting = {x:nearGrub.x, y:nearBranch.y, progress:0, grub:nearGrub};
      document.getElementById('ayeaye-text').textContent = 'Something\'s in there... the finger goes in...';
    } else {
      document.getElementById('ayeaye-text').textContent = nearGrub.taps === 1
        ? 'Tap... tap... hollow! Something\'s in there. Keep tapping.'
        : 'Definitely a grub. One more tap to extract it.';
    }
  }
});

initAyeAye();

// ============ 7. CONSERVATION OUTCOMES ============
const outcomes = [
  {
    name:'Aye-aye ¬∑ Madagascar',
    status:'<span class="outcome-mixed">‚ö† Still endangered</span>',
    detail:'Population uncertain ‚Äî maybe 1,000‚Äì2,000. Madagascar has lost nearly half its forest since Adams visited. The aye-aye is resilient, adaptable, willing to raid coconut plantations (which doesn\'t endear it to farmers). It survives, but on a shrinking island being stripped of everything that made it a refuge.',
    note:'Adams visited in 1985. Madagascar\'s human population has nearly tripled since then. The aye-aye adapts. But there are limits to what adaptation can do when the forest disappears beneath you.'
  },
  {
    name:'Komodo Dragon ¬∑ Indonesia',
    status:'<span class="outcome-mixed">‚ö† Downlisted to Endangered (2021)</span>',
    detail:'Population around 3,000. Climate models predict 30% habitat loss by 2050 ‚Äî rising seas will shrink the islands. The goat-feeding tourist shows have stopped. Komodo National Park now charges $250 entry. The dragons haven\'t changed. The water around their islands has.',
    note:'Adams watched a dragon eat a goat on a hook while tourists photographed from a bandstand. The bandstand is gone. The dragon is still there, for now, waiting with the patience of something that has been waiting for sixty million years.'
  },
  {
    name:'Kakapo ¬∑ New Zealand',
    status:'<span class="outcome-hope">‚úì Recovering ‚Äî 252 individuals (2024)</span>',
    detail:'From 40 to 252. Every bird named. Every egg monitored. Predator-free islands. Supplementary feeding. Artificial insemination. Thirty years of refusing to let the world\'s fattest parrot die. It\'s working ‚Äî slowly, hilariously, against every probability.',
    note:'Adams wrote that the kakapo had "forgotten how to fly, but had also forgotten that it had forgotten how to fly." It still hasn\'t remembered. But 252 birds are alive who wouldn\'t be without the programme Adams helped publicise. The bird that can\'t help itself, helped by people who couldn\'t stop themselves.'
  },
  {
    name:'Baiji ¬∑ Yangtze River, China',
    status:'<span class="outcome-gone">‚úó Functionally extinct (declared 2006)</span>',
    detail:'Gone. A six-week expedition in 2006 surveying the entire Yangtze found nothing. Twenty-five million years of evolution ‚Äî an entire branch of the cetacean family tree ‚Äî erased. The first large vertebrate driven to extinction in fifty years. The first dolphin ever.',
    note:'Adams died in 2001. He never knew. He\'d written about the baiji with particular tenderness ‚Äî the half-blind creature trying to navigate by sound in a river being filled with noise. "A blind man in a discotheque." The discotheque is still running. The blind man is gone. Nobody turned the music down.'
  },
  {
    name:'Northern White Rhino ¬∑ Congo/Kenya',
    status:'<span class="outcome-gone">‚úó Functionally extinct ‚Äî 2 remain (both female)</span>',
    detail:'Najin and Fatu, mother and daughter, at Ol Pejeta Conservancy in Kenya. The last male, Sudan, died on 19 March 2018. Scientists attempt IVF with frozen sperm and southern white rhino surrogates. It is, in every meaningful sense, over. What remains is extraordinary science in service of extraordinary grief.',
    note:'Adams stood 25 yards from a northern white rhino. He wrote that its muscles moved "like Volkswagens parking." Twenty-two remained then. The difference between 22 and 2 was made up of poachers, civil war, and dagger handles in Yemen. "The difference between life or death for one of the rarest and most magnificent animals in the world is actually about twelve dollars."'
  },
  {
    name:'Mountain Gorilla ¬∑ Virunga Mountains',
    status:'<span class="outcome-hope">‚úì Recovering ‚Äî ~1,060 (2023)</span>',
    detail:'From 280 to over 1,000. The Virungas survived two wars. Rangers died protecting gorillas. Tourism ‚Äî the thing Adams helped pioneer simply by writing about them ‚Äî became the economic argument for protection. Each gorilla family generates millions in revenue. Conservation through capitalism. It works, if imperfectly.',
    note:'Adams sat eighteen inches from a silverback who touched his pen. "Not to take it away from me. Just to see what it was." That gorilla\'s descendants are still in those mountains. They still look at humans with the same unhurried, disconcerting intelligence. Adams asked: "Maybe it is not that they have yet to gain a language. It is that we have lost one." The gorillas didn\'t answer. They never needed to.'
  },
  {
    name:'Rodrigues Fruit Bat & Mauritius Kestrel ¬∑ Mauritius',
    status:'<span class="outcome-mixed">‚ö† Mixed ‚Äî kestrel recovered, bat stable</span>',
    detail:'The Mauritius kestrel went from 4 birds to over 400 ‚Äî one of conservation\'s greatest success stories, achieved by Carl Jones, the man who was sent to shut the programme down and refused. The Rodrigues fruit bat remains vulnerable ‚Äî a few thousand on one tiny island, one cyclone from disaster. The pink pigeon: stable at ~400.',
    note:'Adams wrote about Pink, the kestrel so imprinted on Carl Jones that it attempted to mate with his hat. Carl saved the species anyway. "I suppose I have to admit that I\'ve been a complete failure," he said, surrounded by four hundred kestrels that wouldn\'t exist without him. Conservation in one sentence.'
  }
];

function showOutcome(i){
  const o = outcomes[i];
  document.getElementById('outcome-info').innerHTML = `
    <h3>${o.name}</h3>
    <div class="outcome-status">${o.status}</div>
    <p style="font-size:.9rem;line-height:1.7">${o.detail}</p>
    <div class="outcome-adams-note">${o.note}</div>`;
  document.querySelectorAll('.outcome-dot circle').forEach((c,j) => {
    c.setAttribute('opacity', j===i ? '1' : '.5');
    c.setAttribute('r', j===i ? '10' : '7');
  });
}

// ============ NAV HIGHLIGHT ============
const sections = document.querySelectorAll('section');
const navLinks = document.querySelectorAll('nav a');
const observer = new IntersectionObserver(entries=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      navLinks.forEach(l=>l.classList.remove('active'));
      const link = document.querySelector(`nav a[href="#${e.target.id}"]`);
      if(link) link.classList.add('active');
    }
  });
},{threshold:.2,rootMargin:'-80px 0px -40% 0px'});
sections.forEach(s=>observer.observe(s));
</script>
</body>
</html>
